{"version":3,"file":"createFelaRenderer.js","names":["createRenderer","felaPluginEmbedded","felaPluginFallbackValue","felaPluginPlaceholderPrefixer","felaPluginRtl","React","felaDisableAnimationsPlugin","felaExpandCssShorthandsPlugin","felaFocusVisibleEnhancer","felaInvokeKeyframesPlugin","felaPerformanceEnhancer","felaSanitizeCssPlugin","felaStylisEnhancer","RendererProvider","felaDevMode","window","localStorage","_unused","process","env","NODE_ENV","console","warn","join","blocklistedClassNames","filterClassName","className","indexOf","rendererConfig","devMode","enhancers","plugins","createFelaRenderer","options","_options","nonce","felaRenderer","usedRenderers","styleNodeAttributes","Provider","props","createElement","renderer","rehydrate","targetDocument","target","children","registerUsage","unregisterUsage","listeners","nodes","updateSubscription","undefined","renderFont","font","name","paths","renderGlobal","renderStatic","renderRule","styles","param","felaParam","Object","assign","theme","direction","getOriginalRenderer","Error"],"sources":["createFelaRenderer.tsx"],"sourcesContent":["import { CreateRenderer, Renderer } from '@fluentui/react-northstar-styles-renderer';\nimport { createRenderer, IRenderer, IStyle, TPlugin } from 'fela';\nimport felaPluginEmbedded from 'fela-plugin-embedded';\nimport felaPluginFallbackValue from 'fela-plugin-fallback-value';\nimport felaPluginPlaceholderPrefixer from 'fela-plugin-placeholder-prefixer';\nimport felaPluginRtl from 'fela-plugin-rtl';\nimport * as React from 'react';\n\nimport { felaDisableAnimationsPlugin } from './felaDisableAnimationsPlugin';\nimport { felaExpandCssShorthandsPlugin } from './felaExpandCssShorthandsPlugin';\nimport { felaFocusVisibleEnhancer } from './felaFocusVisibleEnhancer';\nimport { felaInvokeKeyframesPlugin } from './felaInvokeKeyframesPlugin';\nimport { felaPerformanceEnhancer } from './felaPerformanceEnhancer';\nimport { felaSanitizeCssPlugin } from './felaSanitizeCssPlugin';\nimport { felaStylisEnhancer } from './felaStylisEnhancer';\nimport { RendererProvider } from './RendererProvider';\nimport { FelaRenderer, FelaRendererParam } from './types';\n\nlet felaDevMode = false;\n\ntry {\n  // eslint-disable-next-line no-undef\n  felaDevMode = !!window.localStorage.felaDevMode;\n} catch {}\n\nif (typeof window !== 'undefined' && process.env.NODE_ENV !== 'production' && process.env.NODE_ENV !== 'test') {\n  if (felaDevMode) {\n    /* eslint-disable-next-line no-console */\n    console.warn(\n      [\n        '@fluentui/react-northstar:',\n        'You are running Fela in development mode and this can cause performance degrades.',\n        'To disable it please paste `delete window.localStorage.felaDevMode` to your browsers console and reload current page.',\n      ].join(' '),\n    );\n  } else {\n    /* eslint-disable-next-line no-console */\n    console.warn(\n      [\n        '@fluentui/react-northstar:',\n        'You are running Fela in production mode.',\n        'This limits your ability to edit styles in browsers development tools.',\n        'To enable development mode please paste `window.localStorage.felaDevMode = true` to your browsers console and reload the page.',\n      ].join(' '),\n    );\n  }\n}\n\nconst blocklistedClassNames = [\n  // Blocklist contains a list of classNames that are used by FontAwesome\n  // https://fontawesome.com/how-to-use/on-the-web/referencing-icons/basic-use\n  'fa',\n  'fas',\n  'far',\n  'fal',\n  'fab',\n  // Used by https://github.com/fullcalendar/fullcalendar\n  'fc',\n  // .cke is used by CKEditor\n  'ck',\n  'cke',\n];\n\nconst filterClassName = (className: string): boolean => {\n  // Also ensure that class name does not contain 'ad' as it might\n  // cause compatibility issues regarding Ad blockers.\n  return className.indexOf('ad') === -1 && blocklistedClassNames.indexOf(className) === -1;\n};\n\nconst rendererConfig = {\n  devMode: felaDevMode,\n  filterClassName,\n  enhancers: [felaPerformanceEnhancer, felaFocusVisibleEnhancer, felaStylisEnhancer],\n  plugins: [\n    felaDisableAnimationsPlugin as TPlugin,\n\n    // is necessary to prevent accidental style typos\n    // from breaking ALL the styles on the page\n    felaSanitizeCssPlugin as TPlugin,\n\n    felaPluginPlaceholderPrefixer(),\n    felaInvokeKeyframesPlugin as TPlugin,\n    felaPluginEmbedded(),\n\n    felaExpandCssShorthandsPlugin as TPlugin,\n\n    // Heads up!\n    // This is required after fela-plugin-prefixer to resolve the array of fallback values prefixer produces.\n    felaPluginFallbackValue(),\n\n    felaPluginRtl(),\n  ],\n};\n\nexport type CreateFelaRendererOptions = {\n  nonce?: string;\n};\n\nexport function createFelaRenderer(options: CreateFelaRendererOptions = {}): CreateRenderer {\n  const { nonce } = options;\n\n  return () => {\n    const felaRenderer = createRenderer(rendererConfig) as FelaRenderer & {\n      listeners: [];\n      nodes: Record<string, HTMLStyleElement>;\n      updateSubscription: Function | undefined;\n    };\n    let usedRenderers: number = 0;\n\n    if (nonce) {\n      felaRenderer.styleNodeAttributes = {\n        nonce,\n      };\n    }\n\n    // rehydration disabled to avoid leaking styles between renderers\n    // https://github.com/rofrischmann/fela/blob/master/docs/api/fela-dom/rehydrate.md\n    const Provider: Renderer['Provider'] = props => (\n      <RendererProvider renderer={felaRenderer} rehydrate={false} targetDocument={props.target}>\n        {props.children}\n      </RendererProvider>\n    );\n\n    return {\n      registerUsage: () => {\n        usedRenderers += 1;\n      },\n      unregisterUsage: () => {\n        usedRenderers -= 1;\n\n        if (usedRenderers === 0) {\n          felaRenderer.listeners = [];\n          felaRenderer.nodes = {};\n          felaRenderer.updateSubscription = undefined;\n        }\n      },\n\n      renderFont: font => {\n        felaRenderer.renderFont(font.name, font.paths, font.props);\n      },\n      renderGlobal: felaRenderer.renderStatic,\n      renderRule: (styles, param) => {\n        const felaParam: FelaRendererParam = {\n          ...param,\n          theme: { direction: param.direction },\n        };\n\n        return felaRenderer.renderRule(() => styles as unknown as IStyle, felaParam);\n      },\n\n      // getOriginalRenderer() is implemented only for tests to be compatible with jest-react-fela expectations.\n      getOriginalRenderer: (): IRenderer => {\n        if (process.env.NODE_ENV !== 'test') {\n          throw new Error('This method implements private API and can be used only in tests');\n        }\n\n        return felaRenderer;\n      },\n\n      Provider,\n    };\n  };\n}\n"],"mappings":"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"}