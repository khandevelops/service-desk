{"version":3,"file":"felaPerformanceEnhancer.js","names":["cssifyDeclaration","generateCombinedMediaQuery","generateCSSSelector","isMediaQuery","isNestedSelector","isSupport","isUndefinedValue","normalizeNestedProperty","RULE_TYPE","isPlainObject","val","Array","isArray","chars","charLength","length","generateUniqueClassName","id","className","generateClassName","getId","filterClassName","startId","generatedClassName","generateDeclarationReference","property","value","pseudo","media","support","felaPerformanceEnhancer","renderer","_renderStyleToClassNames","_ref","_className","style","_objectWithoutPropertiesLoose","_excluded","classNames","combinedMediaQuery","slice","trim","combinedSupport","console","warn","declarationReference","cache","hasOwnProperty","selectorPrefix","getNextRuleIdentifier","declaration","selector","change","type","_emitChange","cachedClassName"],"sources":["felaPerformanceEnhancer.ts"],"sourcesContent":["//\n// This file is one-to-one copy-paste from Fela source code. It includes `_renderStyleToClassNames()` and all\n// non-exported utils.\n// A single change is only one line inside `generateDeclarationReference()`.\n//\n\nimport { ICSSInJSStyle } from '@fluentui/styles';\n// @ts-ignore\nimport cssifyDeclaration from 'css-in-js-utils/lib/cssifyDeclaration';\nimport {\n  // @ts-ignore\n  generateCombinedMediaQuery,\n  // @ts-ignore\n  generateCSSSelector,\n  // @ts-ignore\n  isMediaQuery,\n  // @ts-ignore\n  isNestedSelector,\n  // @ts-ignore\n  isSupport,\n  // @ts-ignore\n  isUndefinedValue,\n  // @ts-ignore\n  normalizeNestedProperty,\n  RULE_TYPE,\n} from 'fela-utils';\n\nimport { FelaRenderer, FelaRendererChange } from './types';\n\nfunction isPlainObject(val: any) {\n  return val != null && typeof val === 'object' && Array.isArray(val) === false;\n}\n\nconst chars = 'abcdefghijklmnopqrstuvwxyz';\nconst charLength = chars.length;\n\nfunction generateUniqueClassName(id: number, className: string = ''): string {\n  if (id <= charLength) {\n    return chars[id - 1] + className;\n  }\n\n  // Bitwise floor as safari performs much faster\n  // https://jsperf.com/math-floor-vs-math-round-vs-parseint/55\n  return generateUniqueClassName((id / charLength) | 0, chars[id % charLength] + className);\n}\n\nfunction generateClassName(getId: Function, filterClassName: Function = () => true): string {\n  const startId = getId();\n  const generatedClassName = generateUniqueClassName(startId);\n\n  if (!filterClassName(generatedClassName)) {\n    return generateClassName(getId, filterClassName);\n  }\n\n  return generatedClassName;\n}\n\nfunction generateDeclarationReference(\n  property: string,\n  value: any,\n  pseudo: string = '',\n  media: string = '',\n  support: string = '',\n): string {\n  //\n  // This a single perf change here, it removes `camelCaseProperty()` call\n  //\n\n  // CHANGE:START\n  return support + media + pseudo + property + value;\n  // CHANGE:END\n}\n\n//\n\nexport function felaPerformanceEnhancer(renderer: FelaRenderer) {\n  renderer._renderStyleToClassNames = function _renderStyleToClassNames(\n    { _className, ...style }: ICSSInJSStyle & { _className?: string },\n    pseudo: string = '',\n    media: string = '',\n    support: string = '',\n  ): string {\n    let classNames = _className ? ` ${_className}` : '';\n\n    for (const property in style) {\n      const value = style[property as keyof ICSSInJSStyle];\n\n      if (isPlainObject(value)) {\n        if (isNestedSelector(property)) {\n          classNames += renderer._renderStyleToClassNames(\n            value as any,\n            pseudo + normalizeNestedProperty(property),\n            media,\n            support,\n          );\n        } else if (isMediaQuery(property)) {\n          const combinedMediaQuery = generateCombinedMediaQuery(media, property.slice(6).trim());\n          classNames += renderer._renderStyleToClassNames(value as any, pseudo, combinedMediaQuery, support);\n        } else if (isSupport(property)) {\n          const combinedSupport = generateCombinedMediaQuery(support, property.slice(9).trim());\n          classNames += renderer._renderStyleToClassNames(value as any, pseudo, media, combinedSupport);\n        } else {\n          // eslint-disable-next-line no-console\n          console.warn(`The object key \"${property}\" is not a valid nested key in Fela.\nMaybe you forgot to add a plugin to resolve it?\nCheck http://fela.js.org/docs/basics/Rules.html#styleobject for more information.`);\n        }\n      } else {\n        const declarationReference = generateDeclarationReference(property, value, pseudo, media, support);\n\n        if (!renderer.cache.hasOwnProperty(declarationReference)) {\n          // we remove undefined values to enable\n          // usage of optional props without side-effects\n          if (isUndefinedValue(value)) {\n            renderer.cache[declarationReference] = {\n              className: '',\n            } as FelaRendererChange;\n            /* eslint-disable no-continue */\n            continue;\n            /* eslint-enable */\n          }\n\n          const className =\n            renderer.selectorPrefix + generateClassName(renderer.getNextRuleIdentifier, renderer.filterClassName);\n\n          const declaration = cssifyDeclaration(property, value);\n          const selector = generateCSSSelector(className, pseudo);\n\n          const change = {\n            type: RULE_TYPE,\n            className,\n            selector,\n            declaration,\n            pseudo,\n            media,\n            support,\n          };\n\n          renderer.cache[declarationReference] = change;\n          renderer._emitChange(change);\n        }\n\n        const cachedClassName = renderer.cache[declarationReference].className;\n\n        // only append if we got a class cached\n        if (cachedClassName) {\n          classNames += ` ${cachedClassName}`;\n        }\n      }\n    }\n\n    return classNames;\n  };\n\n  return renderer;\n}\n"],"mappings":"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"}