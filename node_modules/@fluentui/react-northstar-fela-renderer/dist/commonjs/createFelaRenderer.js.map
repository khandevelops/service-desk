{"version":3,"file":"createFelaRenderer.js","names":["_fela","require","_felaPluginEmbedded","_interopRequireDefault","_felaPluginFallbackValue","_felaPluginPlaceholderPrefixer","_felaPluginRtl","React","_interopRequireWildcard","_felaDisableAnimationsPlugin","_felaExpandCssShorthandsPlugin","_felaFocusVisibleEnhancer","_felaInvokeKeyframesPlugin","_felaPerformanceEnhancer","_felaSanitizeCssPlugin","_felaStylisEnhancer","_RendererProvider","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","felaDevMode","window","localStorage","_unused","process","env","NODE_ENV","console","warn","join","blocklistedClassNames","filterClassName","className","indexOf","rendererConfig","devMode","enhancers","felaPerformanceEnhancer","felaFocusVisibleEnhancer","felaStylisEnhancer","plugins","felaDisableAnimationsPlugin","felaSanitizeCssPlugin","felaPluginPlaceholderPrefixer","felaInvokeKeyframesPlugin","felaPluginEmbedded","felaExpandCssShorthandsPlugin","felaPluginFallbackValue","felaPluginRtl","createFelaRenderer","options","_options","nonce","felaRenderer","createRenderer","usedRenderers","styleNodeAttributes","Provider","props","createElement","RendererProvider","renderer","rehydrate","targetDocument","target","children","registerUsage","unregisterUsage","listeners","nodes","updateSubscription","undefined","renderFont","font","name","paths","renderGlobal","renderStatic","renderRule","styles","param","felaParam","assign","theme","direction","getOriginalRenderer","Error"],"sources":["createFelaRenderer.tsx"],"sourcesContent":["import { CreateRenderer, Renderer } from '@fluentui/react-northstar-styles-renderer';\nimport { createRenderer, IRenderer, IStyle, TPlugin } from 'fela';\nimport felaPluginEmbedded from 'fela-plugin-embedded';\nimport felaPluginFallbackValue from 'fela-plugin-fallback-value';\nimport felaPluginPlaceholderPrefixer from 'fela-plugin-placeholder-prefixer';\nimport felaPluginRtl from 'fela-plugin-rtl';\nimport * as React from 'react';\n\nimport { felaDisableAnimationsPlugin } from './felaDisableAnimationsPlugin';\nimport { felaExpandCssShorthandsPlugin } from './felaExpandCssShorthandsPlugin';\nimport { felaFocusVisibleEnhancer } from './felaFocusVisibleEnhancer';\nimport { felaInvokeKeyframesPlugin } from './felaInvokeKeyframesPlugin';\nimport { felaPerformanceEnhancer } from './felaPerformanceEnhancer';\nimport { felaSanitizeCssPlugin } from './felaSanitizeCssPlugin';\nimport { felaStylisEnhancer } from './felaStylisEnhancer';\nimport { RendererProvider } from './RendererProvider';\nimport { FelaRenderer, FelaRendererParam } from './types';\n\nlet felaDevMode = false;\n\ntry {\n  // eslint-disable-next-line no-undef\n  felaDevMode = !!window.localStorage.felaDevMode;\n} catch {}\n\nif (typeof window !== 'undefined' && process.env.NODE_ENV !== 'production' && process.env.NODE_ENV !== 'test') {\n  if (felaDevMode) {\n    /* eslint-disable-next-line no-console */\n    console.warn(\n      [\n        '@fluentui/react-northstar:',\n        'You are running Fela in development mode and this can cause performance degrades.',\n        'To disable it please paste `delete window.localStorage.felaDevMode` to your browsers console and reload current page.',\n      ].join(' '),\n    );\n  } else {\n    /* eslint-disable-next-line no-console */\n    console.warn(\n      [\n        '@fluentui/react-northstar:',\n        'You are running Fela in production mode.',\n        'This limits your ability to edit styles in browsers development tools.',\n        'To enable development mode please paste `window.localStorage.felaDevMode = true` to your browsers console and reload the page.',\n      ].join(' '),\n    );\n  }\n}\n\nconst blocklistedClassNames = [\n  // Blocklist contains a list of classNames that are used by FontAwesome\n  // https://fontawesome.com/how-to-use/on-the-web/referencing-icons/basic-use\n  'fa',\n  'fas',\n  'far',\n  'fal',\n  'fab',\n  // Used by https://github.com/fullcalendar/fullcalendar\n  'fc',\n  // .cke is used by CKEditor\n  'ck',\n  'cke',\n];\n\nconst filterClassName = (className: string): boolean => {\n  // Also ensure that class name does not contain 'ad' as it might\n  // cause compatibility issues regarding Ad blockers.\n  return className.indexOf('ad') === -1 && blocklistedClassNames.indexOf(className) === -1;\n};\n\nconst rendererConfig = {\n  devMode: felaDevMode,\n  filterClassName,\n  enhancers: [felaPerformanceEnhancer, felaFocusVisibleEnhancer, felaStylisEnhancer],\n  plugins: [\n    felaDisableAnimationsPlugin as TPlugin,\n\n    // is necessary to prevent accidental style typos\n    // from breaking ALL the styles on the page\n    felaSanitizeCssPlugin as TPlugin,\n\n    felaPluginPlaceholderPrefixer(),\n    felaInvokeKeyframesPlugin as TPlugin,\n    felaPluginEmbedded(),\n\n    felaExpandCssShorthandsPlugin as TPlugin,\n\n    // Heads up!\n    // This is required after fela-plugin-prefixer to resolve the array of fallback values prefixer produces.\n    felaPluginFallbackValue(),\n\n    felaPluginRtl(),\n  ],\n};\n\nexport type CreateFelaRendererOptions = {\n  nonce?: string;\n};\n\nexport function createFelaRenderer(options: CreateFelaRendererOptions = {}): CreateRenderer {\n  const { nonce } = options;\n\n  return () => {\n    const felaRenderer = createRenderer(rendererConfig) as FelaRenderer & {\n      listeners: [];\n      nodes: Record<string, HTMLStyleElement>;\n      updateSubscription: Function | undefined;\n    };\n    let usedRenderers: number = 0;\n\n    if (nonce) {\n      felaRenderer.styleNodeAttributes = {\n        nonce,\n      };\n    }\n\n    // rehydration disabled to avoid leaking styles between renderers\n    // https://github.com/rofrischmann/fela/blob/master/docs/api/fela-dom/rehydrate.md\n    const Provider: Renderer['Provider'] = props => (\n      <RendererProvider renderer={felaRenderer} rehydrate={false} targetDocument={props.target}>\n        {props.children}\n      </RendererProvider>\n    );\n\n    return {\n      registerUsage: () => {\n        usedRenderers += 1;\n      },\n      unregisterUsage: () => {\n        usedRenderers -= 1;\n\n        if (usedRenderers === 0) {\n          felaRenderer.listeners = [];\n          felaRenderer.nodes = {};\n          felaRenderer.updateSubscription = undefined;\n        }\n      },\n\n      renderFont: font => {\n        felaRenderer.renderFont(font.name, font.paths, font.props);\n      },\n      renderGlobal: felaRenderer.renderStatic,\n      renderRule: (styles, param) => {\n        const felaParam: FelaRendererParam = {\n          ...param,\n          theme: { direction: param.direction },\n        };\n\n        return felaRenderer.renderRule(() => styles as unknown as IStyle, felaParam);\n      },\n\n      // getOriginalRenderer() is implemented only for tests to be compatible with jest-react-fela expectations.\n      getOriginalRenderer: (): IRenderer => {\n        if (process.env.NODE_ENV !== 'test') {\n          throw new Error('This method implements private API and can be used only in tests');\n        }\n\n        return felaRenderer;\n      },\n\n      Provider,\n    };\n  };\n}\n"],"mappings":"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"}