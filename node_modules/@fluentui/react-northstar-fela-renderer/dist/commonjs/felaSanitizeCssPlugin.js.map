{"version":3,"file":"felaSanitizeCssPlugin.js","names":["isValidCssValue","value","openingBrackets","closingBrackets","openingBracketsStack","i","length","currentCharacter","includes","push","lastOpeningBracket","pop","indexOf","cssPropertiesToSkip","felaSanitizeCssPlugin","styles","type","renderer","props","sanitizeCss","processedStyles","Array","isArray","Object","keys","forEach","cssPropertyNameOrIndex","cssPropertyValue","isPropertyToSkip","some","propToExclude","process","env","NODE_ENV","console","warn","exports"],"sources":["felaSanitizeCssPlugin.ts"],"sourcesContent":["import { ICSSInJSStyle } from '@fluentui/styles';\nimport { TRuleType } from 'fela-utils';\n\nimport { FelaRenderer, FelaRendererParam } from './types';\n\n/**\n * Checks whether provided CSS property value is safe for being rendered by Fela engine.\n */\nconst isValidCssValue = (value: any) => {\n  if (typeof value !== 'string') {\n    return true;\n  }\n\n  const openingBrackets = '({[';\n  const closingBrackets = ')}]';\n\n  const openingBracketsStack: string[] = [];\n\n  /**\n   * This loop logic checks whether braces sequence of input argument is valid.\n   * Essentially, it ensures that each of the '(', '{', '[' braces\n   * - is properly matched by its complementary closing character\n   * - closing brace properly corresponds to the last opened one\n   */\n  for (let i = 0; i < value.length; ++i) {\n    const currentCharacter = value[i];\n    if (openingBrackets.includes(currentCharacter)) {\n      openingBracketsStack.push(currentCharacter);\n    } else if (closingBrackets.includes(currentCharacter)) {\n      const lastOpeningBracket = openingBracketsStack.pop();\n      if (\n        lastOpeningBracket &&\n        openingBrackets.indexOf(lastOpeningBracket) !== closingBrackets.indexOf(currentCharacter)\n      ) {\n        return false;\n      }\n    }\n  }\n\n  return openingBracketsStack.length === 0;\n};\n\nconst cssPropertiesToSkip = ['content', 'keyframe'];\n\nexport const felaSanitizeCssPlugin = (\n  styles: ICSSInJSStyle,\n  type: TRuleType,\n  renderer: FelaRenderer,\n  props: FelaRendererParam,\n): ICSSInJSStyle => {\n  if (!props.sanitizeCss) {\n    return styles;\n  }\n\n  const processedStyles: any = Array.isArray(styles) ? [] : {};\n\n  Object.keys(styles).forEach((cssPropertyNameOrIndex: keyof ICSSInJSStyle) => {\n    const cssPropertyValue = styles[cssPropertyNameOrIndex];\n\n    if (typeof cssPropertyValue === 'object') {\n      processedStyles[cssPropertyNameOrIndex] = felaSanitizeCssPlugin(\n        cssPropertyValue as ICSSInJSStyle,\n        type,\n        renderer,\n        props,\n      );\n      return;\n    }\n\n    const isPropertyToSkip = cssPropertiesToSkip.some(propToExclude => propToExclude === cssPropertyNameOrIndex);\n\n    if (isPropertyToSkip) {\n      processedStyles[cssPropertyNameOrIndex] = cssPropertyValue;\n      return;\n    }\n\n    if (isValidCssValue(cssPropertyValue)) {\n      processedStyles[cssPropertyNameOrIndex] = cssPropertyValue;\n    } else if (process.env.NODE_ENV !== 'production') {\n      // eslint-disable-next-line no-console\n      console.warn(\n        `fela-sanitize-css: An invalid value \"${cssPropertyValue}\" was passed to property \"${cssPropertyNameOrIndex}\"`,\n      );\n    }\n  });\n\n  return processedStyles;\n};\n"],"mappings":";;;;AAKA;AACA;AACA;AACA,IAAMA,eAAe,GAAG,SAAlBA,eAAeA,CAAIC,KAAU,EAAK;EACtC,IAAI,OAAOA,KAAK,KAAK,QAAQ,EAAE;IAC7B,OAAO,IAAI;EACb;EAEA,IAAMC,eAAe,GAAG,KAAK;EAC7B,IAAMC,eAAe,GAAG,KAAK;EAE7B,IAAMC,oBAA8B,GAAG,EAAE;;EAEzC;AACF;AACA;AACA;AACA;AACA;EACE,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGJ,KAAK,CAACK,MAAM,EAAE,EAAED,CAAC,EAAE;IACrC,IAAME,gBAAgB,GAAGN,KAAK,CAACI,CAAC,CAAC;IACjC,IAAIH,eAAe,CAACM,QAAQ,CAACD,gBAAgB,CAAC,EAAE;MAC9CH,oBAAoB,CAACK,IAAI,CAACF,gBAAgB,CAAC;IAC7C,CAAC,MAAM,IAAIJ,eAAe,CAACK,QAAQ,CAACD,gBAAgB,CAAC,EAAE;MACrD,IAAMG,kBAAkB,GAAGN,oBAAoB,CAACO,GAAG,CAAC,CAAC;MACrD,IACED,kBAAkB,IAClBR,eAAe,CAACU,OAAO,CAACF,kBAAkB,CAAC,KAAKP,eAAe,CAACS,OAAO,CAACL,gBAAgB,CAAC,EACzF;QACA,OAAO,KAAK;MACd;IACF;EACF;EAEA,OAAOH,oBAAoB,CAACE,MAAM,KAAK,CAAC;AAC1C,CAAC;AAED,IAAMO,mBAAmB,GAAG,CAAC,SAAS,EAAE,UAAU,CAAC;AAE5C,IAAMC,qBAAqB,GAAG,SAAxBA,qBAAqBA,CAChCC,MAAqB,EACrBC,IAAe,EACfC,QAAsB,EACtBC,KAAwB,EACN;EAClB,IAAI,CAACA,KAAK,CAACC,WAAW,EAAE;IACtB,OAAOJ,MAAM;EACf;EAEA,IAAMK,eAAoB,GAAGC,KAAK,CAACC,OAAO,CAACP,MAAM,CAAC,GAAG,EAAE,GAAG,CAAC,CAAC;EAE5DQ,MAAM,CAACC,IAAI,CAACT,MAAM,CAAC,CAACU,OAAO,CAAC,UAACC,sBAA2C,EAAK;IAC3E,IAAMC,gBAAgB,GAAGZ,MAAM,CAACW,sBAAsB,CAAC;IAEvD,IAAI,OAAOC,gBAAgB,KAAK,QAAQ,EAAE;MACxCP,eAAe,CAACM,sBAAsB,CAAC,GAAGZ,qBAAqB,CAC7Da,gBAAgB,EAChBX,IAAI,EACJC,QAAQ,EACRC,KACF,CAAC;MACD;IACF;IAEA,IAAMU,gBAAgB,GAAGf,mBAAmB,CAACgB,IAAI,CAAC,UAAAC,aAAa;MAAA,OAAIA,aAAa,KAAKJ,sBAAsB;IAAA,EAAC;IAE5G,IAAIE,gBAAgB,EAAE;MACpBR,eAAe,CAACM,sBAAsB,CAAC,GAAGC,gBAAgB;MAC1D;IACF;IAEA,IAAI3B,eAAe,CAAC2B,gBAAgB,CAAC,EAAE;MACrCP,eAAe,CAACM,sBAAsB,CAAC,GAAGC,gBAAgB;IAC5D,CAAC,MAAM,IAAII,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,EAAE;MAChD;MACAC,OAAO,CAACC,IAAI,4CAC8BR,gBAAgB,oCAA6BD,sBAAsB,OAC7G,CAAC;IACH;EACF,CAAC,CAAC;EAEF,OAAON,eAAe;AACxB,CAAC;AAACgB,OAAA,CAAAtB,qBAAA,GAAAA,qBAAA"}