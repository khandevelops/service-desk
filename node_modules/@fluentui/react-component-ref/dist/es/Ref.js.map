{"version":3,"file":"Ref.js","names":["React","ReactIs","ReactDOM","handleRef","isFiberRef","node","Element","Text","type","tag","Ref","_React$Component","_inheritsLoose","_this","_len","arguments","length","args","Array","_key","call","apply","concat","prevNode","currentNode","state","kind","handleForwardRefOverride","_this$props","props","children","innerRef","ref","handleSelfOverride","_this$props2","getDerivedStateFromProps","child","Children","only","isForwardRef","_proto","prototype","componentDidMount","findDOMNode","process","env","NODE_ENV","componentDidUpdate","prevProps","isNodeChanged","isRefChanged","componentWillUnmount","render","_this$props3","rest","_objectWithoutPropertiesLoose","_excluded","childWithProps","Object","keys","cloneElement","Component"],"sources":["Ref.tsx"],"sourcesContent":["import * as React from 'react';\nimport * as ReactIs from 'react-is';\nimport * as ReactDOM from 'react-dom';\n\nimport { handleRef } from './utils';\n\nexport interface RefProps {\n  children: React.ReactElement;\n\n  /**\n   * Called when a child component will be mounted or updated.\n   *\n   * @param node - Referred node.\n   */\n  innerRef: React.Ref<HTMLElement>;\n}\n\nexport interface RefState {\n  kind: 'self' | 'forward' | 'find' | null;\n}\n\n// ========================================================\n// react/packages/react-reconciler/src/ReactFiber.js\n// ========================================================\n\ntype Fiber = {\n  // Tag identifying the type of fiber.\n  tag: string;\n  // The resolved function/class/ associated with this fiber.\n  type: any;\n};\n\n/**\n * Detects if a passed element is a Fiber object instead of an element. Is needed as `ReactDOM.findDOMNode()` returns\n * a Fiber in `react-test-renderer` that can cause issues with tests. Is used only in non-production env.\n *\n * @see https://github.com/facebook/react/issues/7371#issuecomment-317396864\n * @see https://github.com/Semantic-Org/Semantic-UI-React/issues/4061#issuecomment-694895617\n */\nfunction isFiberRef(node: Element | Fiber | Text | null): boolean {\n  if (node === null) {\n    return false;\n  }\n\n  if (node instanceof Element || node instanceof Text) {\n    return false;\n  }\n\n  return !!(node.type && node.tag);\n}\n\nexport class Ref extends React.Component<RefProps, RefState> {\n  prevNode?: Node | null;\n  currentNode?: Node | null;\n\n  state = { kind: null };\n\n  static getDerivedStateFromProps(props: RefProps): RefState {\n    const child = React.Children.only(props.children);\n\n    if (child.type === Ref) {\n      return { kind: 'self' };\n    }\n\n    if (ReactIs.isForwardRef(child)) {\n      return { kind: 'forward' };\n    }\n\n    return { kind: 'find' };\n  }\n\n  handleForwardRefOverride = (node: HTMLElement) => {\n    const { children, innerRef } = this.props;\n\n    handleRef((children as React.ReactElement & { ref: React.Ref<any> }).ref, node);\n    handleRef(innerRef, node);\n\n    this.currentNode = node;\n  };\n\n  handleSelfOverride = (node: HTMLElement) => {\n    const { children, innerRef } = this.props;\n\n    handleRef((children as React.ReactElement<RefProps>).props.innerRef, node);\n    handleRef(innerRef, node);\n  };\n\n  componentDidMount() {\n    if (this.state.kind === 'find') {\n      let currentNode = ReactDOM.findDOMNode(this);\n\n      if (process.env.NODE_ENV !== 'production') {\n        if (isFiberRef(currentNode)) {\n          currentNode = null;\n        }\n      }\n\n      this.prevNode = currentNode;\n      handleRef(this.props.innerRef, currentNode);\n    }\n  }\n\n  componentDidUpdate(prevProps: RefProps) {\n    if (this.state.kind === 'forward') {\n      if (prevProps.innerRef !== this.props.innerRef) {\n        handleRef(this.props.innerRef, this.currentNode);\n      }\n    } else if (this.state.kind === 'find') {\n      let currentNode = ReactDOM.findDOMNode(this);\n\n      if (process.env.NODE_ENV !== 'production') {\n        if (isFiberRef(currentNode)) {\n          currentNode = null;\n        }\n      }\n\n      const isNodeChanged = this.prevNode !== currentNode;\n      const isRefChanged = prevProps.innerRef !== this.props.innerRef;\n\n      if (isNodeChanged) {\n        this.prevNode = currentNode;\n      }\n\n      if (isNodeChanged || isRefChanged) {\n        handleRef(this.props.innerRef, currentNode);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.state.kind === 'forward') {\n      delete this.currentNode;\n    } else if (this.state.kind === 'find') {\n      handleRef(this.props.innerRef, null);\n      delete this.prevNode;\n    }\n  }\n\n  render() {\n    const { children, innerRef, ...rest } = this.props;\n    const childWithProps = rest && Object.keys(rest).length > 0 ? React.cloneElement(children, rest) : children;\n\n    if (this.state.kind === 'find') {\n      return childWithProps;\n    }\n\n    if (this.state.kind === 'forward') {\n      return React.cloneElement(childWithProps, {\n        ref: this.handleForwardRefOverride,\n      });\n    }\n\n    if (this.state.kind === 'self') {\n      return React.cloneElement(childWithProps, {\n        innerRef: this.handleSelfOverride,\n      });\n    }\n\n    return null;\n  }\n}\n"],"mappings":"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"}