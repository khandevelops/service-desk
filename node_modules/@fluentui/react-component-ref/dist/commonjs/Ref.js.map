{"version":3,"file":"Ref.js","names":["React","_interopRequireWildcard","require","ReactIs","ReactDOM","_utils","_excluded","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","isFiberRef","node","Element","Text","type","tag","Ref","_React$Component","_inheritsLoose2","_this","_len","arguments","length","args","Array","_key","apply","concat","prevNode","currentNode","state","kind","handleForwardRefOverride","_this$props","props","children","innerRef","handleRef","ref","handleSelfOverride","_this$props2","getDerivedStateFromProps","child","Children","only","isForwardRef","_proto","componentDidMount","findDOMNode","process","env","NODE_ENV","componentDidUpdate","prevProps","isNodeChanged","isRefChanged","componentWillUnmount","render","_this$props3","rest","_objectWithoutPropertiesLoose2","childWithProps","keys","cloneElement","Component","exports"],"sources":["Ref.tsx"],"sourcesContent":["import * as React from 'react';\nimport * as ReactIs from 'react-is';\nimport * as ReactDOM from 'react-dom';\n\nimport { handleRef } from './utils';\n\nexport interface RefProps {\n  children: React.ReactElement;\n\n  /**\n   * Called when a child component will be mounted or updated.\n   *\n   * @param node - Referred node.\n   */\n  innerRef: React.Ref<HTMLElement>;\n}\n\nexport interface RefState {\n  kind: 'self' | 'forward' | 'find' | null;\n}\n\n// ========================================================\n// react/packages/react-reconciler/src/ReactFiber.js\n// ========================================================\n\ntype Fiber = {\n  // Tag identifying the type of fiber.\n  tag: string;\n  // The resolved function/class/ associated with this fiber.\n  type: any;\n};\n\n/**\n * Detects if a passed element is a Fiber object instead of an element. Is needed as `ReactDOM.findDOMNode()` returns\n * a Fiber in `react-test-renderer` that can cause issues with tests. Is used only in non-production env.\n *\n * @see https://github.com/facebook/react/issues/7371#issuecomment-317396864\n * @see https://github.com/Semantic-Org/Semantic-UI-React/issues/4061#issuecomment-694895617\n */\nfunction isFiberRef(node: Element | Fiber | Text | null): boolean {\n  if (node === null) {\n    return false;\n  }\n\n  if (node instanceof Element || node instanceof Text) {\n    return false;\n  }\n\n  return !!(node.type && node.tag);\n}\n\nexport class Ref extends React.Component<RefProps, RefState> {\n  prevNode?: Node | null;\n  currentNode?: Node | null;\n\n  state = { kind: null };\n\n  static getDerivedStateFromProps(props: RefProps): RefState {\n    const child = React.Children.only(props.children);\n\n    if (child.type === Ref) {\n      return { kind: 'self' };\n    }\n\n    if (ReactIs.isForwardRef(child)) {\n      return { kind: 'forward' };\n    }\n\n    return { kind: 'find' };\n  }\n\n  handleForwardRefOverride = (node: HTMLElement) => {\n    const { children, innerRef } = this.props;\n\n    handleRef((children as React.ReactElement & { ref: React.Ref<any> }).ref, node);\n    handleRef(innerRef, node);\n\n    this.currentNode = node;\n  };\n\n  handleSelfOverride = (node: HTMLElement) => {\n    const { children, innerRef } = this.props;\n\n    handleRef((children as React.ReactElement<RefProps>).props.innerRef, node);\n    handleRef(innerRef, node);\n  };\n\n  componentDidMount() {\n    if (this.state.kind === 'find') {\n      let currentNode = ReactDOM.findDOMNode(this);\n\n      if (process.env.NODE_ENV !== 'production') {\n        if (isFiberRef(currentNode)) {\n          currentNode = null;\n        }\n      }\n\n      this.prevNode = currentNode;\n      handleRef(this.props.innerRef, currentNode);\n    }\n  }\n\n  componentDidUpdate(prevProps: RefProps) {\n    if (this.state.kind === 'forward') {\n      if (prevProps.innerRef !== this.props.innerRef) {\n        handleRef(this.props.innerRef, this.currentNode);\n      }\n    } else if (this.state.kind === 'find') {\n      let currentNode = ReactDOM.findDOMNode(this);\n\n      if (process.env.NODE_ENV !== 'production') {\n        if (isFiberRef(currentNode)) {\n          currentNode = null;\n        }\n      }\n\n      const isNodeChanged = this.prevNode !== currentNode;\n      const isRefChanged = prevProps.innerRef !== this.props.innerRef;\n\n      if (isNodeChanged) {\n        this.prevNode = currentNode;\n      }\n\n      if (isNodeChanged || isRefChanged) {\n        handleRef(this.props.innerRef, currentNode);\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.state.kind === 'forward') {\n      delete this.currentNode;\n    } else if (this.state.kind === 'find') {\n      handleRef(this.props.innerRef, null);\n      delete this.prevNode;\n    }\n  }\n\n  render() {\n    const { children, innerRef, ...rest } = this.props;\n    const childWithProps = rest && Object.keys(rest).length > 0 ? React.cloneElement(children, rest) : children;\n\n    if (this.state.kind === 'find') {\n      return childWithProps;\n    }\n\n    if (this.state.kind === 'forward') {\n      return React.cloneElement(childWithProps, {\n        ref: this.handleForwardRefOverride,\n      });\n    }\n\n    if (this.state.kind === 'self') {\n      return React.cloneElement(childWithProps, {\n        innerRef: this.handleSelfOverride,\n      });\n    }\n\n    return null;\n  }\n}\n"],"mappings":"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"}