{"version":3,"file":"createManager.js","names":["createManager","config","actions","debug","_config$middleware","middleware","_config$sideEffects","sideEffects","state","_state","Object","assign","getState","setState","partial","manager","keys","forEach","actionName","enhancedAction","action","prevState","_len","arguments","length","args","Array","_key","applyAction","apply","concat","applyMiddleware","applySideEffects","process","env","NODE_ENV","console","log","name","_len2","_key2","actionResult","middlewareItem","index","prev","next","sideEffect","exports"],"sources":["createManager.ts"],"sourcesContent":["import { AnyActions, EnhancedAction, Manager, ManagerConfig } from './types';\n\nexport const createManager = <State, Actions extends AnyActions>(\n  config: ManagerConfig<State, Actions>,\n): Manager<State, Actions> => {\n  const { actions, debug, middleware = [], sideEffects = [], state } = config;\n  const _state: State = { ...state } as State;\n\n  const getState = (): State => ({ ..._state });\n  const setState = (partial: Partial<State>): State => Object.assign(_state, partial);\n\n  const manager: Manager<State, Actions> = {\n    actions: {} as Actions,\n    get state() {\n      return getState();\n    },\n  };\n\n  // assign actions to manager's api\n  Object.keys(actions).forEach(actionName => {\n    const enhancedAction = actions[actionName];\n    const action = (...args: Parameters<typeof enhancedAction>) => {\n      const prevState = getState();\n\n      applyAction(enhancedAction, ...args);\n\n      applyMiddleware(prevState);\n      applySideEffects(prevState);\n    };\n    (manager.actions as any)[actionName] = action;\n  });\n\n  const applyAction = <A extends EnhancedAction<State, Actions>>(action: A, ...args: Parameters<A>) => {\n    if (process.env.NODE_ENV !== 'production') {\n      if (debug) {\n        // eslint-disable-next-line no-console\n        console.log('manager ACTION', action.name || 'Anonymous');\n      }\n    }\n    const actionResult = action(...args)(getState(), manager.actions);\n\n    if (actionResult) {\n      setState(actionResult);\n    }\n  };\n\n  const applyMiddleware = (prevState: State) => {\n    middleware.forEach((middlewareItem, index) => {\n      if (process.env.NODE_ENV !== 'production') {\n        if (debug) {\n          // eslint-disable-next-line no-console\n          console.log(`manager MIDDLEWARE[${index}]`, {\n            prev: prevState,\n            next: getState(),\n          });\n        }\n      }\n\n      setState(middlewareItem(prevState, getState(), manager.actions));\n    });\n  };\n\n  const applySideEffects = (prevState: State): void => {\n    sideEffects.forEach((sideEffect, index) => {\n      if (process.env.NODE_ENV !== 'production') {\n        if (debug) {\n          // eslint-disable-next-line no-console\n          console.log(`manager SIDE_EFFECT[${index}]`);\n        }\n      }\n\n      sideEffect(prevState, manager.state);\n    });\n  };\n\n  return manager;\n};\n"],"mappings":"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"}