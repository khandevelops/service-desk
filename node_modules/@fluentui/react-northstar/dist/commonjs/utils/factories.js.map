{"version":3,"file":"factories.js","names":["mappedProps","iframe","img","input","createShorthandFactory","Component","mappedProp","mappedArrayProp","allowsJSX","ReactIs","isValidElementType","Error","value","options","createShorthandInternal","valIsNoop","render","valIsPrimitive","valIsPropsObject","valIsArray","valIsReactElement","React","isValidElement","process","env","NODE_ENV","displayName","console","error","join","defaultProps","usersProps","overrideProps","props","mappedHTMLProps","as","className","mergedClassesNames","cx","split","style","styles","mergeStyles","generateKey","key","elementKey","isNullKey","kind","children","undefined","createElement","createShorthand","shorthandConfig","fluentComposeConfig"],"sources":["utils/factories.ts"],"sourcesContent":["import { mergeStyles } from '@fluentui/styles';\nimport { ComponentWithAs, ComposePreparedOptions, ShorthandConfig } from '@fluentui/react-bindings';\nimport cx from 'classnames';\nimport * as _ from 'lodash';\nimport * as React from 'react';\nimport * as ReactIs from 'react-is';\n\nimport { ShorthandValue, Props, PropsOf, ShorthandRenderFunction } from '../types';\n\ntype HTMLTag = 'iframe' | 'img' | 'input';\ntype ShorthandProp = 'children' | 'src' | 'type';\n\ninterface CreateShorthandOptions<P> {\n  /** Default props object */\n  defaultProps?: () => Partial<Props<P>>;\n\n  /** Override props object or function (called with regular props) */\n  overrideProps?: Partial<Props<P>> | ((props: P) => Partial<Props<P>>);\n\n  /** Whether or not automatic key generation is allowed */\n  generateKey?: boolean;\n\n  /** Override the default render implementation. */\n  render?: ShorthandRenderFunction<P>;\n}\n\n// It's only necessary to map props that don't use 'children' as value ('children' is the default)\nconst mappedProps: { [key in HTMLTag]: ShorthandProp } = {\n  iframe: 'src',\n  img: 'src',\n  input: 'type',\n};\n\nexport type ShorthandFactory<P> = (\n  value: ShorthandValue<P>,\n  options?: CreateShorthandOptions<P>,\n) => React.ReactElement | null | undefined;\n\n// ============================================================\n// Factory Creators\n// ============================================================\n\n/**\n * @param config - Options passed to factory\n * @returns A shorthand factory function waiting for `val` and `defaultProps`.\n */\nexport function createShorthandFactory<TStringElement extends keyof JSX.IntrinsicElements, P>(config: {\n  /** A ReactClass or string */\n  Component: TStringElement;\n  /** A function that maps a primitive value to the Component props */\n  mappedProp?: keyof PropsOf<TStringElement>;\n  /** A function that maps an array value to the Component props */\n  mappedArrayProp?: keyof PropsOf<TStringElement>;\n  /** Indicates if factory supports React Elements */\n  allowsJSX?: boolean;\n}): ShorthandFactory<P>;\nexport function createShorthandFactory<TFunctionComponent extends React.FunctionComponent, P>(config: {\n  Component: TFunctionComponent;\n  mappedProp?: keyof PropsOf<TFunctionComponent>;\n  mappedArrayProp?: keyof PropsOf<TFunctionComponent>;\n  allowsJSX?: boolean;\n}): ShorthandFactory<P>;\nexport function createShorthandFactory<TInstance extends React.Component, P>(config: {\n  Component: { new (...args: any[]): TInstance };\n  mappedProp?: keyof PropsOf<TInstance>;\n  mappedArrayProp?: keyof PropsOf<TInstance>;\n  allowsJSX?: boolean;\n}): ShorthandFactory<P>;\nexport function createShorthandFactory<P>({ Component, mappedProp, mappedArrayProp, allowsJSX }) {\n  if (!ReactIs.isValidElementType(Component)) {\n    throw new Error('createShorthandFactory() Component must be a string or function.');\n  }\n\n  return (value, options: CreateShorthandOptions<P>) =>\n    createShorthandInternal({\n      allowsJSX,\n      Component,\n      mappedProp,\n      mappedArrayProp,\n      value,\n      options,\n    });\n}\n\n// ============================================================\n// Factories\n// ============================================================\n\nexport function createShorthandInternal<P>({\n  Component,\n  mappedProp,\n  mappedArrayProp,\n  value,\n  options = {},\n  allowsJSX = true,\n}: {\n  Component: React.ElementType<P>;\n  mappedProp?: string;\n  mappedArrayProp?: string;\n  allowsJSX?: boolean;\n  value?: ShorthandValue<P>;\n  options?: CreateShorthandOptions<P>;\n}) {\n  if (!ReactIs.isValidElementType(Component)) {\n    throw new Error('createShorthand() Component must be a string or function.');\n  }\n\n  // short circuit noop values\n  const valIsNoop = _.isNil(value) || typeof value === 'boolean';\n  if (valIsNoop && !options.render) return null;\n\n  const valIsPrimitive = typeof value === 'string' || typeof value === 'number';\n  const valIsPropsObject = _.isPlainObject(value);\n  const valIsArray = _.isArray(value);\n  const valIsReactElement = React.isValidElement(value);\n\n  // unhandled type warning\n  if (process.env.NODE_ENV !== 'production') {\n    const displayName = typeof Component === 'string' ? Component : Component.displayName;\n\n    if (!valIsPrimitive && !valIsPropsObject && !valIsArray && !valIsReactElement && !valIsNoop) {\n      /* eslint-disable-next-line no-console */\n      console.error(\n        [\n          `The shorthand prop for \"${displayName}\" component was passed a JSX element but this slot only supports string|number|object|array|ReactElements.`,\n          ' Use null|undefined|boolean for none.',\n          ` Received: ${value}`,\n        ].join(''),\n      );\n    }\n\n    if (!allowsJSX && valIsReactElement) {\n      /* eslint-disable-next-line no-console */\n      console.error(\n        [\n          `The shorthand prop for \"${displayName}\" component was passed a JSX element but this slot only supports string|number|object|array.`,\n          ' Use null|undefined|boolean for none.',\n          ` Received: ${value}`,\n        ].join(''),\n      );\n    }\n  }\n\n  // ----------------------------------------\n  // Build up props\n  // ----------------------------------------\n  const defaultProps = options.defaultProps ? options.defaultProps() || ({} as Props<P>) : ({} as Props<P>);\n\n  // User's props\n  const usersProps =\n    (valIsReactElement && ({} as Props<P>)) || (valIsPropsObject && (value as Props<P>)) || ({} as Props<P>);\n\n  // Override props\n  const overrideProps: Props<P> =\n    typeof options.overrideProps === 'function'\n      ? (options.overrideProps({ ...defaultProps, ...usersProps }) as Props<P>)\n      : (options.overrideProps as Props<P>) || ({} as Props<P>);\n\n  // Merge props\n  const props: Props<P> = { ...defaultProps, ...usersProps, ...overrideProps };\n\n  const mappedHTMLProps = mappedProps[overrideProps.as || defaultProps.as];\n\n  // Map prop for primitive value\n  if (valIsPrimitive || valIsReactElement) {\n    (props as any)[mappedHTMLProps || mappedProp || 'children'] = value;\n  }\n\n  // Map prop for array value\n  if (valIsArray) {\n    (props as any)[mappedHTMLProps || mappedArrayProp || 'children'] = value;\n  }\n\n  // Merge className\n  if (defaultProps.className || overrideProps.className || usersProps.className) {\n    const mergedClassesNames = cx(defaultProps.className, overrideProps.className, usersProps.className);\n    (props as any).className = _.uniq(mergedClassesNames.split(' ')).join(' ');\n  }\n\n  // Merge style\n  if (defaultProps.style || overrideProps.style || usersProps.style) {\n    (props as any).style = { ...defaultProps.style, ...usersProps.style, ...overrideProps.style };\n  }\n\n  // Merge styles\n  if (defaultProps.styles || overrideProps.styles || usersProps.styles) {\n    (props as any).styles = mergeStyles(defaultProps.styles, usersProps.styles, overrideProps.styles);\n  }\n\n  // ----------------------------------------\n  // Get key\n  // ----------------------------------------\n  const { generateKey = true } = options;\n\n  // Use key or generate key\n  if (generateKey && _.isNil(props.key)) {\n    if (valIsPrimitive) {\n      // use string/number shorthand values as the key\n      (props as any).key = value;\n    }\n\n    if (valIsReactElement) {\n      // use the key from React Element\n      const elementKey = (value as React.ReactElement).key;\n      // <div /> - key is not passed as will be `null`\n      // <div key={null} /> - key is passed as `null` and will be stringified\n      const isNullKey = elementKey === null;\n\n      if (!isNullKey) {\n        (props as any).key = elementKey;\n      }\n    }\n  }\n\n  // Remove the kind prop from the props object\n  delete props.kind;\n\n  // ----------------------------------------\n  // Create Element\n  // ----------------------------------------\n  const { render } = options;\n  if (render) {\n    return render(Component, props);\n  }\n\n  if (typeof props.children === 'function') {\n    return props.children(Component, { ...props, children: undefined });\n  }\n\n  if (!allowsJSX && valIsReactElement) {\n    return null;\n  }\n\n  // Create ReactElements from built up props\n  if (valIsPrimitive || valIsPropsObject || valIsArray || valIsReactElement) {\n    return React.createElement(Component, props);\n  }\n\n  return null;\n}\n\nexport function createShorthand<TFunctionComponent extends React.FunctionComponent>(\n  Component: TFunctionComponent & {\n    shorthandConfig?: ShorthandConfig<PropsOf<TFunctionComponent>>;\n    fluentComposeConfig?: ComposePreparedOptions<PropsOf<TFunctionComponent>>;\n  },\n  value?: ShorthandValue<PropsOf<TFunctionComponent>>,\n  options?: CreateShorthandOptions<PropsOf<TFunctionComponent>>,\n): React.ReactElement;\nexport function createShorthand<TInstance extends React.Component>(\n  Component: { new (...args: any[]): TInstance } & {\n    shorthandConfig?: ShorthandConfig<PropsOf<TInstance>>;\n    fluentComposeConfig?: ComposePreparedOptions<PropsOf<TInstance>>;\n  },\n  value?: ShorthandValue<PropsOf<TInstance>>,\n  options?: CreateShorthandOptions<PropsOf<TInstance>>,\n): React.ReactElement;\nexport function createShorthand<E extends keyof JSX.IntrinsicElements, P>(\n  Component: ComponentWithAs<E, P> & {\n    shorthandConfig?: ShorthandConfig<P>;\n    fluentComposeConfig?: ComposePreparedOptions<P>;\n  },\n  value?: ShorthandValue<P>,\n  options?: CreateShorthandOptions<P>,\n): React.ReactElement;\nexport function createShorthand<TElementType extends React.ElementType>(\n  Component: TElementType & {\n    shorthandConfig?: ShorthandConfig<PropsOf<TElementType>>;\n    fluentComposeConfig?: ComposePreparedOptions<PropsOf<TElementType>>;\n  },\n  value?: ShorthandValue<PropsOf<TElementType>>,\n  options?: CreateShorthandOptions<PropsOf<TElementType>>,\n): React.ReactElement;\nexport function createShorthand<P>(Component, value?, options?) {\n  const { mappedProp = 'children', allowsJSX = true, mappedArrayProp } =\n    Component.shorthandConfig || Component.fluentComposeConfig?.shorthandConfig || {};\n\n  return createShorthandInternal<P>({\n    Component,\n    mappedProp,\n    allowsJSX,\n    mappedArrayProp,\n    value,\n    options: options || {},\n  });\n}\n"],"mappings":"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"}