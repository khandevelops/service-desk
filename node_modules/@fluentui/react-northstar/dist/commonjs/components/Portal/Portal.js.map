{"version":3,"file":"Portal.js","names":["Portal","props","context","useFluentContext","useTelemetry","displayName","telemetry","setStart","setEnd","children","content","trapFocus","trigger","triggerAccessibility","portalRef","React","useRef","triggerRef","useAutoControlled","defaultValue","defaultOpen","value","open","initialValue","setOpen","renderPortal","contentToRender","childrenExist","focusTrapZoneProps","length","handleMount","handleUnmount","rtlTextContainer","getAttributes","forElements","handleDocumentClick","target","renderTrigger","handleTriggerRef","cloneElement","onClick","handleTriggerClick","attributes","keyHandlers","node","current","handleRef","e","unhandledProps","isOpen","doesNodeContainClick","element","propTypes","commonPropTypes","createCommon","accessibility","as","className","styled","PropTypes","bool","onMount","func","onUnmount","customPropTypes","ref","object","onTriggerClick","onOutsideClick","oneOfType","handledProps","Object","keys","create","createShorthandFactory","Component","defaultProps"],"sources":["components/Portal/Portal.tsx"],"sourcesContent":["import { AccessibilityAttributes } from '@fluentui/accessibility';\nimport {\n  AccessibilityHandlerProps,\n  FocusTrapZone,\n  FocusTrapZoneProps,\n  useFluentContext,\n  useTelemetry,\n  useAutoControlled,\n} from '@fluentui/react-bindings';\nimport { EventListener } from '@fluentui/react-component-event-listener';\nimport { handleRef, Ref } from '@fluentui/react-component-ref';\nimport * as customPropTypes from '@fluentui/react-proptypes';\nimport * as PropTypes from 'prop-types';\nimport * as React from 'react';\nimport * as _ from 'lodash';\nimport { FluentComponentStaticProps } from '../../types';\nimport {\n  childrenExist,\n  doesNodeContainClick,\n  ChildrenComponentProps,\n  commonPropTypes,\n  ContentComponentProps,\n  rtlTextContainer,\n  createShorthandFactory,\n} from '../../utils';\nimport { PortalInner } from './PortalInner';\n\nexport type TriggerAccessibility = {\n  attributes?: AccessibilityAttributes;\n  keyHandlers?: AccessibilityHandlerProps;\n};\n\nexport interface PortalProps extends ChildrenComponentProps, ContentComponentProps {\n  /** Initial value of open. */\n  defaultOpen?: boolean;\n\n  /**\n   * Called when the portal is mounted on the DOM.\n   *\n   * @param data - All props.\n   */\n  onMount?: (props: PortalProps) => void;\n\n  /**\n   * Called when the portal is unmounted from the DOM.\n   *\n   * @param data - All props.\n   */\n  onUnmount?: (props: PortalProps) => void;\n\n  /** Controls whether or not the portal is displayed. */\n  open?: boolean;\n\n  /** Element to be rendered in-place where the portal is defined. */\n  trigger?: JSX.Element;\n\n  /** Controls whether or not focus trap should be applied, using boolean or FocusTrapZoneProps type value */\n  trapFocus?: FocusTrapZoneProps | boolean;\n\n  /** Accessibility behavior object to apply on trigger node. */\n  triggerAccessibility?: TriggerAccessibility;\n\n  /** Sets trigger node to passed ref. */\n  triggerRef?: React.Ref<any>;\n\n  /**\n   * Called when trigger node was clicked.\n   *\n   * @param data - All props.\n   */\n  onTriggerClick?: (e: React.MouseEvent) => void;\n\n  /**\n   * Called when `click` event was invoked outside portal or trigger nodes.\n   *\n   * @param data - All props.\n   */\n  onOutsideClick?: (e: React.MouseEvent) => void;\n}\n\n/**\n * (DEPRECATED) A Portal allows to render children outside of their parent.\n *\n * @deprecated Please use \"Popup\" or \"Dialog\" components instead.\n */\nexport const Portal: React.FC<PortalProps> & FluentComponentStaticProps<PortalProps> = props => {\n  const context = useFluentContext();\n  const { setStart, setEnd } = useTelemetry(Portal.displayName, context.telemetry);\n  setStart();\n  const { children, content, trapFocus, trigger, triggerAccessibility } = props;\n  const portalRef = React.useRef<HTMLElement>();\n  const triggerRef = React.useRef<HTMLElement>();\n\n  const [open, setOpen] = useAutoControlled({\n    defaultValue: props.defaultOpen,\n    value: props.open,\n    initialValue: false,\n  });\n\n  const renderPortal = (): JSX.Element | undefined => {\n    const contentToRender = childrenExist(children) ? children : content;\n    const focusTrapZoneProps = (_.keys(trapFocus).length && trapFocus) || {};\n    return (\n      open && (\n        <Ref innerRef={portalRef}>\n          <PortalInner\n            onMount={handleMount}\n            onUnmount={handleUnmount}\n            {...rtlTextContainer.getAttributes({ forElements: [contentToRender] })}\n          >\n            {trapFocus ? <FocusTrapZone {...focusTrapZoneProps}>{contentToRender}</FocusTrapZone> : contentToRender}\n            <EventListener listener={handleDocumentClick} target={context.target} type=\"click\" />\n          </PortalInner>\n        </Ref>\n      )\n    );\n  };\n\n  const renderTrigger = (): JSX.Element | undefined => {\n    return (\n      trigger && (\n        <Ref innerRef={handleTriggerRef}>\n          {React.cloneElement(trigger, {\n            onClick: handleTriggerClick,\n            ...triggerAccessibility.attributes,\n            ...triggerAccessibility.keyHandlers,\n          })}\n        </Ref>\n      )\n    );\n  };\n\n  const handleMount = () => {\n    _.invoke(props, 'onMount', props);\n  };\n\n  const handleUnmount = () => {\n    _.invoke(props, 'onUnmount', props);\n  };\n\n  const handleTriggerRef = (node: HTMLElement) => {\n    triggerRef.current = node;\n    handleRef(props.triggerRef, node);\n  };\n\n  const handleTriggerClick = (e: React.MouseEvent, ...unhandledProps) => {\n    _.invoke(props, 'onTriggerClick', e); // Call handler from parent component\n    _.invoke(trigger, 'props.onClick', e, ...unhandledProps); // Call original event handler\n    setOpen(isOpen => !isOpen);\n  };\n\n  const handleDocumentClick = (e: MouseEvent) => {\n    if (\n      !portalRef || // no portal\n      doesNodeContainClick(triggerRef.current, e, context.target) || // event happened in trigger (delegate to trigger handlers)\n      doesNodeContainClick(portalRef.current, e, context.target) // event happened in the portal\n    ) {\n      return; // ignore the click\n    }\n    _.invoke(props, 'onOutsideClick', e);\n    setOpen(false);\n  };\n\n  const element = (\n    <>\n      {renderPortal()}\n      {renderTrigger()}\n    </>\n  );\n  setEnd();\n  return element;\n};\n\nPortal.propTypes = {\n  ...commonPropTypes.createCommon({\n    accessibility: false,\n    as: false,\n    className: false,\n    styled: false,\n  }),\n  defaultOpen: PropTypes.bool,\n  onMount: PropTypes.func,\n  onUnmount: PropTypes.func,\n  open: PropTypes.bool,\n  trigger: PropTypes.element,\n  triggerRef: customPropTypes.ref,\n  triggerAccessibility: PropTypes.object,\n  onTriggerClick: PropTypes.func,\n  onOutsideClick: PropTypes.func,\n  trapFocus: PropTypes.oneOfType([PropTypes.bool, PropTypes.object]),\n};\n\nPortal.handledProps = Object.keys(Portal.propTypes) as any;\n\nPortal.create = createShorthandFactory({\n  Component: Portal,\n});\n\nPortal.defaultProps = {\n  triggerAccessibility: {},\n};\n"],"mappings":"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"}