{"version":3,"file":"useTree.js","names":["useGetItemById","flatTree","callbackRef","React","useRef","Error","current","itemId","process","env","NODE_ENV","Object","freeze","useCallback","useStableProps","props","stableProps","useEffect","useTree","options","deprecated_initialActiveItemIds","useMemo","deprecated_getInitialActiveItemIds","items","useAutoControlled","defaultValue","defaultActiveItemIds","value","activeItemIds","initialValue","setActiveItemIdsState","defaultSelectedItemIds","selectedItemIds","setSelectedItemIdsState","flattenTree","visibleItemIds","getItemById","toggleItemActive","e","idToToggle","item","hasSubtree","nextActiveItemIds","isActiveId","indexOf","exclusive","parent","activeSibling","childrenIds","find","id","expandSiblings","focusedItemId","focusedItem","parentItem","siblingsIds","concat","toggleItemSelect","leafs","getLeafNodes","nextSelectedItemIds","selected","nodes","registerItemRef","node","getItemRef","focusItemById","itemRef","HTMLElement","focus","firstElementChild","searchByFirstChar","startIndex","endIndex","char","i","itemFirstChar","textContent","trim","charAt","toLowerCase","getToFocusIDByFirstCharacter","idToStartSearch","starIndex","length","toFocusIndex","key","result","forEach","expanded","push","rootId","traverseDown","child"],"sources":["components/Tree/hooks/useTree.ts"],"sourcesContent":["import * as React from 'react';\nimport { useAutoControlled } from '@fluentui/react-bindings';\nimport { ObjectShorthandCollection } from '../../../types';\nimport { TreeItemProps } from '../TreeItem';\nimport { FlatTreeItem, flattenTree, FlatTree } from './flattenTree';\nimport * as _ from 'lodash';\n\nexport type GetItemById = (id: string) => FlatTreeItem;\n\n/**\n * This hook returns a stable `getItemById()` function that will lookup in latest `flatTree`.\n * This is used to have stable callbacks that can be passed to React's Context.\n */\nfunction useGetItemById(flatTree: FlatTree): GetItemById {\n  // An exception is thrown there to ensure that a proper callback will assigned to ref\n  const callbackRef = React.useRef<GetItemById>(() => {\n    throw new Error('Callback is not assigned yet');\n  });\n\n  // We are assigning a callback during render as it can be used during render and in event handlers. In dev mode we\n  // are freezing objects to prevent their mutations\n  callbackRef.current = itemId =>\n    process.env.NODE_ENV === 'production' ? flatTree[itemId] : Object.freeze(flatTree[itemId]);\n\n  return React.useCallback<GetItemById>((...args) => {\n    return callbackRef.current(...args);\n  }, []);\n}\n\nfunction useStableProps<P>(props: P) {\n  const stableProps = React.useRef<P>(props);\n\n  React.useEffect(() => {\n    stableProps.current = props;\n  });\n\n  return stableProps;\n}\n\nexport interface UseTreeOptions {\n  /** Shorthand array of props for Tree. */\n  items?: ObjectShorthandCollection<TreeItemProps>;\n\n  /** Ids of expanded items. */\n  activeItemIds?: string[];\n  /** Initial activeItemIds value. */\n  defaultActiveItemIds?: string[];\n  /** Only allow one subtree to be expanded at a time. */\n  exclusive?: boolean;\n\n  /** Ids of selected leaf items. */\n  selectedItemIds?: string[];\n  /** Initial selectedItemIds value. */\n  defaultSelectedItemIds?: string[];\n}\n\nexport interface UseTreeResult {\n  /** An object with key being id of each tree item, and value being information of each tree item */\n  flatTree: FlatTree;\n\n  /** Access information of a tree item */\n  getItemById: GetItemById;\n\n  /** Ids of expanded items. */\n  activeItemIds: string[];\n\n  /** Ids of visible items */\n  visibleItemIds: string[];\n\n  /** register ref to a tree item, should be used in callback ref on tree item */\n  registerItemRef: (id: string, node: HTMLElement) => void;\n\n  /** get ref to a tree item by its id */\n  getItemRef: (id: string) => HTMLElement;\n\n  /** update the state of tree when a tree item is expanded/collapsed */\n  toggleItemActive: (e: React.SyntheticEvent, idToToggle: string) => void;\n\n  /** set focus on a tree item by its id. Useful for keyboard navigation */\n  focusItemById: (id: string) => void;\n\n  /** update the state of tree when it is needed to expand all siblings of a tree item, for example on '*' keydown */\n  expandSiblings: (e: React.KeyboardEvent, focusedItemId: string) => void;\n\n  /** update the state of tree when a tree item is selected/unselected */\n  toggleItemSelect: (e: React.SyntheticEvent, idToToggle: string) => void;\n\n  /**\n   * When a-z/A-Z key is pressed on a tree item, move focus to the next visible tree node with content that starts with the typed char.\n   * Search wraps to first matching node if a matching is not found among the nodes that follow the focused node.\n   * Focus stays when no matching is found among all visible nodes.\n   */\n  getToFocusIDByFirstCharacter: (e: React.KeyboardEvent, idToToggle: string) => string;\n}\n\nexport function useTree(options: UseTreeOptions): UseTreeResult {\n  // We need this because we want to handle `expanded` prop on `items`, should be deprecated and removed\n  const deprecated_initialActiveItemIds = React.useMemo(\n    () => deprecated_getInitialActiveItemIds(options.items),\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    [], // initialValue only needs to be computed on mount\n  );\n\n  const [activeItemIds, setActiveItemIdsState] = useAutoControlled<string[]>({\n    defaultValue: options.defaultActiveItemIds,\n    value: options.activeItemIds,\n    initialValue: deprecated_initialActiveItemIds, // will become []\n  });\n\n  // selectedItemIds is only valid for leaf nodes.\n  // For non-leaf nodes, their 'selected' states are defered from all their descendents\n  const [selectedItemIds, setSelectedItemIdsState] = useAutoControlled<string[]>({\n    defaultValue: options.defaultSelectedItemIds,\n    value: options.selectedItemIds,\n    initialValue: [],\n  });\n\n  // We want to set `visibleItemIds` to simplify rendering later\n  const { flatTree, visibleItemIds } = React.useMemo(() => flattenTree(options.items, activeItemIds, selectedItemIds), [\n    activeItemIds,\n    options.items,\n    selectedItemIds,\n  ]);\n\n  const getItemById = useGetItemById(flatTree);\n\n  const stableProps = useStableProps(options);\n\n  const toggleItemActive = React.useCallback(\n    (e: React.SyntheticEvent, idToToggle: string) => {\n      const item = getItemById(idToToggle);\n      if (!item || !item.hasSubtree) {\n        // leaf node does not have the concept of active/inactive\n        return;\n      }\n\n      setActiveItemIdsState(activeItemIds => {\n        let nextActiveItemIds: string[];\n        const isActiveId = activeItemIds.indexOf(idToToggle) !== -1;\n\n        if (isActiveId) {\n          nextActiveItemIds = _.without(activeItemIds, idToToggle);\n        } else {\n          nextActiveItemIds = [...activeItemIds, idToToggle];\n\n          if (options.exclusive) {\n            // remove active siblings, if any, from activeItemIds\n            const parent = getItemById(idToToggle)?.parent;\n            const activeSibling = getItemById(parent)?.childrenIds?.find(\n              id => id !== idToToggle && nextActiveItemIds.indexOf(id) >= 0,\n            );\n            if (activeSibling != null) {\n              nextActiveItemIds = _.without(nextActiveItemIds, activeSibling);\n            }\n          }\n        }\n\n        _.invoke(stableProps.current, 'onActiveItemIdsChange', e, {\n          ...stableProps.current,\n          activeItemIds: nextActiveItemIds,\n        });\n\n        return nextActiveItemIds;\n      });\n    },\n    [getItemById, options.exclusive, setActiveItemIdsState, stableProps],\n  );\n\n  const expandSiblings = React.useCallback(\n    (e: React.KeyboardEvent, focusedItemId: string) => {\n      if (options.exclusive) {\n        return;\n      }\n\n      const focusedItem = getItemById(focusedItemId);\n      if (!focusedItem) {\n        return;\n      }\n\n      const parentItem = getItemById(focusedItem?.parent);\n      const siblingsIds = parentItem?.childrenIds;\n\n      if (!siblingsIds) {\n        return;\n      }\n\n      setActiveItemIdsState(activeItemIds => {\n        const nextActiveItemIds = _.uniq(activeItemIds.concat(siblingsIds));\n        _.invoke(stableProps.current, 'onActiveItemIdsChange', e, {\n          ...stableProps.current,\n          activeItemIds: nextActiveItemIds,\n        });\n        return nextActiveItemIds;\n      });\n    },\n    [getItemById, options.exclusive, setActiveItemIdsState, stableProps],\n  );\n\n  const toggleItemSelect = React.useCallback(\n    (e: React.SyntheticEvent, idToToggle: string) => {\n      const item = getItemById(idToToggle);\n      if (!item) {\n        return;\n      }\n      const leafs = getLeafNodes(getItemById, idToToggle);\n\n      setSelectedItemIdsState(selectedItemIds => {\n        const nextSelectedItemIds =\n          item.selected === true\n            ? _.without(selectedItemIds, ...leafs) // remove all leaves from selected\n            : _.uniq(selectedItemIds.concat(leafs)); // add all leaves to selected\n        _.invoke(stableProps.current, 'onSelectedItemIdsChange', e, {\n          ...stableProps.current,\n          selectedItemIds: nextSelectedItemIds,\n        });\n        return nextSelectedItemIds;\n      });\n    },\n    [getItemById, setSelectedItemIdsState, stableProps],\n  );\n\n  // Maintains stable collection of refs to avoid unnecessary React context updates\n  const nodes = React.useRef<Record<string, HTMLElement>>({});\n  const registerItemRef = React.useCallback((id: string, node: HTMLElement) => {\n    nodes.current[id] = node;\n  }, []);\n  const getItemRef = React.useCallback((id): HTMLElement => nodes.current[id], []);\n\n  // can be used for keyboard navigation ===\n  const focusItemById = React.useCallback(\n    (id: string) => {\n      const itemRef = getItemRef(id);\n\n      if (itemRef instanceof HTMLElement) {\n        if (getItemById(id)?.hasSubtree) {\n          itemRef.focus();\n        } else {\n          // when node is leaf, need to focus on the inner treeTitle\n          (itemRef.firstElementChild as HTMLElement)?.focus();\n        }\n      }\n    },\n    [getItemById, getItemRef],\n  );\n\n  const searchByFirstChar = React.useCallback(\n    (startIndex: number, endIndex: number, char: string) => {\n      for (let i = startIndex; i < endIndex; ++i) {\n        // get first charater of tree node using the same way aria does (https://www.w3.org/TR/wai-aria-practices-1.1/examples/treeview/treeview-2/js/treeitemLinks.js)\n        const itemFirstChar = getItemRef(visibleItemIds[i])?.textContent?.trim()?.charAt(0)?.toLowerCase();\n        if (itemFirstChar === char.toLowerCase()) {\n          return i;\n        }\n      }\n      return -1;\n    },\n    [getItemRef, visibleItemIds],\n  );\n\n  const getToFocusIDByFirstCharacter = React.useCallback(\n    (e: React.KeyboardEvent, idToStartSearch: string) => {\n      // Get start index for search\n      let starIndex = visibleItemIds.indexOf(idToStartSearch) + 1;\n      if (starIndex === visibleItemIds.length) {\n        starIndex = 0;\n      }\n\n      // Check following nodes in tree\n      let toFocusIndex = searchByFirstChar(starIndex, visibleItemIds.length, e.key);\n      // If not found in following nodes, check from beginning\n      if (toFocusIndex === -1) {\n        toFocusIndex = searchByFirstChar(0, starIndex - 1, e.key);\n      }\n\n      if (toFocusIndex === -1) {\n        return idToStartSearch;\n      }\n\n      return visibleItemIds[toFocusIndex];\n    },\n    [searchByFirstChar, visibleItemIds],\n  );\n\n  return {\n    flatTree,\n    getItemById,\n    activeItemIds,\n    visibleItemIds,\n    registerItemRef,\n    getItemRef,\n    toggleItemActive,\n    focusItemById,\n    expandSiblings,\n    toggleItemSelect,\n    getToFocusIDByFirstCharacter,\n  };\n}\n\nfunction deprecated_getInitialActiveItemIds(items?: ObjectShorthandCollection<TreeItemProps>) {\n  if (!items) {\n    return [];\n  }\n\n  let result = [];\n  items.forEach(item => {\n    if (item.expanded) {\n      result.push(item.id);\n    }\n\n    if (item.items) {\n      result = result.concat(\n        deprecated_getInitialActiveItemIds(item.items as ObjectShorthandCollection<TreeItemProps>),\n      );\n    }\n  });\n  return result;\n}\n\nfunction getLeafNodes(getItemById: (id: string) => FlatTreeItem, rootId: string) {\n  const leafs = [];\n  const traverseDown = id => {\n    if (getItemById(id)?.childrenIds) {\n      getItemById(id)?.childrenIds.forEach(child => {\n        traverseDown(child);\n      });\n    } else {\n      leafs.push(id);\n    }\n  };\n  traverseDown(rootId);\n  return leafs;\n}\n"],"mappings":";;;;;;;;AAAA;AACA;AAGA;AAAoE;AAAA;AAKpE;AACA;AACA;AACA;AACA,SAASA,cAAc,CAACC,QAAkB,EAAe;EACvD;EACA,IAAMC,WAAW,GAAGC,KAAK,CAACC,MAAM,CAAc,YAAM;IAClD,MAAM,IAAIC,KAAK,CAAC,8BAA8B,CAAC;EACjD,CAAC,CAAC;;EAEF;EACA;EACAH,WAAW,CAACI,OAAO,GAAG,UAAAC,MAAM;IAAA,OAC1BC,OAAO,CAACC,GAAG,CAACC,QAAQ,KAAK,YAAY,GAAGT,QAAQ,CAACM,MAAM,CAAC,GAAGI,MAAM,CAACC,MAAM,CAACX,QAAQ,CAACM,MAAM,CAAC,CAAC;EAAA;EAE5F,OAAOJ,KAAK,CAACU,WAAW,CAAc,YAAa;IACjD,OAAOX,WAAW,CAACI,OAAO,OAAnBJ,WAAW,YAAiB;EACrC,CAAC,EAAE,EAAE,CAAC;AACR;AAEA,SAASY,cAAc,CAAIC,KAAQ,EAAE;EACnC,IAAMC,WAAW,GAAGb,KAAK,CAACC,MAAM,CAAIW,KAAK,CAAC;EAE1CZ,KAAK,CAACc,SAAS,CAAC,YAAM;IACpBD,WAAW,CAACV,OAAO,GAAGS,KAAK;EAC7B,CAAC,CAAC;EAEF,OAAOC,WAAW;AACpB;AA0DO,SAASE,OAAO,CAACC,OAAuB,EAAiB;EAC9D;EACA,IAAMC,+BAA+B,GAAGjB,KAAK,CAACkB,OAAO,CACnD;IAAA,OAAMC,kCAAkC,CAACH,OAAO,CAACI,KAAK,CAAC;EAAA;EACvD;EACA,EAAE,CAAE;EAAA,CACL;;EAED,yBAA+C,IAAAC,gCAAiB,EAAW;MACzEC,YAAY,EAAEN,OAAO,CAACO,oBAAoB;MAC1CC,KAAK,EAAER,OAAO,CAACS,aAAa;MAC5BC,YAAY,EAAET,+BAA+B,CAAE;IACjD,CAAC,CAAC;IAJKQ,aAAa;IAAEE,qBAAqB;;EAM3C;EACA;EACA,0BAAmD,IAAAN,gCAAiB,EAAW;MAC7EC,YAAY,EAAEN,OAAO,CAACY,sBAAsB;MAC5CJ,KAAK,EAAER,OAAO,CAACa,eAAe;MAC9BH,YAAY,EAAE;IAChB,CAAC,CAAC;IAJKG,eAAe;IAAEC,uBAAuB;;EAM/C;EACA,qBAAqC9B,KAAK,CAACkB,OAAO,CAAC;MAAA,OAAM,IAAAa,wBAAW,EAACf,OAAO,CAACI,KAAK,EAAEK,aAAa,EAAEI,eAAe,CAAC;IAAA,GAAE,CACnHJ,aAAa,EACbT,OAAO,CAACI,KAAK,EACbS,eAAe,CAChB,CAAC;IAJM/B,QAAQ,kBAARA,QAAQ;IAAEkC,cAAc,kBAAdA,cAAc;EAMhC,IAAMC,WAAW,GAAGpC,cAAc,CAACC,QAAQ,CAAC;EAE5C,IAAMe,WAAW,GAAGF,cAAc,CAACK,OAAO,CAAC;EAE3C,IAAMkB,gBAAgB,GAAGlC,KAAK,CAACU,WAAW,CACxC,UAACyB,CAAuB,EAAEC,UAAkB,EAAK;IAC/C,IAAMC,IAAI,GAAGJ,WAAW,CAACG,UAAU,CAAC;IACpC,IAAI,CAACC,IAAI,IAAI,CAACA,IAAI,CAACC,UAAU,EAAE;MAC7B;MACA;IACF;IAEAX,qBAAqB,CAAC,UAAAF,aAAa,EAAI;MACrC,IAAIc,iBAA2B;MAC/B,IAAMC,UAAU,GAAGf,aAAa,CAACgB,OAAO,CAACL,UAAU,CAAC,KAAK,CAAC,CAAC;MAE3D,IAAII,UAAU,EAAE;QACdD,iBAAiB,GAAG,uBAAUd,aAAa,EAAEW,UAAU,CAAC;MAC1D,CAAC,MAAM;QACLG,iBAAiB,aAAOd,aAAa,GAAEW,UAAU,EAAC;QAElD,IAAIpB,OAAO,CAAC0B,SAAS,EAAE;UAAA;UACrB;UACA,IAAMC,MAAM,mBAAGV,WAAW,CAACG,UAAU,CAAC,qBAAvB,aAAyBO,MAAM;UAC9C,IAAMC,aAAa,oBAAGX,WAAW,CAACU,MAAM,CAAC,8CAAnB,cAAqBE,WAAW,qBAAhC,sBAAkCC,IAAI,CAC1D,UAAAC,EAAE;YAAA,OAAIA,EAAE,KAAKX,UAAU,IAAIG,iBAAiB,CAACE,OAAO,CAACM,EAAE,CAAC,IAAI,CAAC;UAAA,EAC9D;UACD,IAAIH,aAAa,IAAI,IAAI,EAAE;YACzBL,iBAAiB,GAAG,uBAAUA,iBAAiB,EAAEK,aAAa,CAAC;UACjE;QACF;MACF;MAEA,sBAAS/B,WAAW,CAACV,OAAO,EAAE,uBAAuB,EAAEgC,CAAC,oBACnDtB,WAAW,CAACV,OAAO;QACtBsB,aAAa,EAAEc;MAAiB,GAChC;MAEF,OAAOA,iBAAiB;IAC1B,CAAC,CAAC;EACJ,CAAC,EACD,CAACN,WAAW,EAAEjB,OAAO,CAAC0B,SAAS,EAAEf,qBAAqB,EAAEd,WAAW,CAAC,CACrE;EAED,IAAMmC,cAAc,GAAGhD,KAAK,CAACU,WAAW,CACtC,UAACyB,CAAsB,EAAEc,aAAqB,EAAK;IACjD,IAAIjC,OAAO,CAAC0B,SAAS,EAAE;MACrB;IACF;IAEA,IAAMQ,WAAW,GAAGjB,WAAW,CAACgB,aAAa,CAAC;IAC9C,IAAI,CAACC,WAAW,EAAE;MAChB;IACF;IAEA,IAAMC,UAAU,GAAGlB,WAAW,CAACiB,WAAW,oBAAXA,WAAW,CAAEP,MAAM,CAAC;IACnD,IAAMS,WAAW,GAAGD,UAAU,oBAAVA,UAAU,CAAEN,WAAW;IAE3C,IAAI,CAACO,WAAW,EAAE;MAChB;IACF;IAEAzB,qBAAqB,CAAC,UAAAF,aAAa,EAAI;MACrC,IAAMc,iBAAiB,GAAG,oBAAOd,aAAa,CAAC4B,MAAM,CAACD,WAAW,CAAC,CAAC;MACnE,sBAASvC,WAAW,CAACV,OAAO,EAAE,uBAAuB,EAAEgC,CAAC,oBACnDtB,WAAW,CAACV,OAAO;QACtBsB,aAAa,EAAEc;MAAiB,GAChC;MACF,OAAOA,iBAAiB;IAC1B,CAAC,CAAC;EACJ,CAAC,EACD,CAACN,WAAW,EAAEjB,OAAO,CAAC0B,SAAS,EAAEf,qBAAqB,EAAEd,WAAW,CAAC,CACrE;EAED,IAAMyC,gBAAgB,GAAGtD,KAAK,CAACU,WAAW,CACxC,UAACyB,CAAuB,EAAEC,UAAkB,EAAK;IAC/C,IAAMC,IAAI,GAAGJ,WAAW,CAACG,UAAU,CAAC;IACpC,IAAI,CAACC,IAAI,EAAE;MACT;IACF;IACA,IAAMkB,KAAK,GAAGC,YAAY,CAACvB,WAAW,EAAEG,UAAU,CAAC;IAEnDN,uBAAuB,CAAC,UAAAD,eAAe,EAAI;MACzC,IAAM4B,mBAAmB,GACvBpB,IAAI,CAACqB,QAAQ,KAAK,IAAI,GAClB,iCAAU7B,eAAe,SAAK0B,KAAK,EAAC,CAAC;MAAA,EACrC,oBAAO1B,eAAe,CAACwB,MAAM,CAACE,KAAK,CAAC,CAAC,CAAC,CAAC;MAC7C,sBAAS1C,WAAW,CAACV,OAAO,EAAE,yBAAyB,EAAEgC,CAAC,oBACrDtB,WAAW,CAACV,OAAO;QACtB0B,eAAe,EAAE4B;MAAmB,GACpC;MACF,OAAOA,mBAAmB;IAC5B,CAAC,CAAC;EACJ,CAAC,EACD,CAACxB,WAAW,EAAEH,uBAAuB,EAAEjB,WAAW,CAAC,CACpD;;EAED;EACA,IAAM8C,KAAK,GAAG3D,KAAK,CAACC,MAAM,CAA8B,CAAC,CAAC,CAAC;EAC3D,IAAM2D,eAAe,GAAG5D,KAAK,CAACU,WAAW,CAAC,UAACqC,EAAU,EAAEc,IAAiB,EAAK;IAC3EF,KAAK,CAACxD,OAAO,CAAC4C,EAAE,CAAC,GAAGc,IAAI;EAC1B,CAAC,EAAE,EAAE,CAAC;EACN,IAAMC,UAAU,GAAG9D,KAAK,CAACU,WAAW,CAAC,UAACqC,EAAE;IAAA,OAAkBY,KAAK,CAACxD,OAAO,CAAC4C,EAAE,CAAC;EAAA,GAAE,EAAE,CAAC;;EAEhF;EACA,IAAMgB,aAAa,GAAG/D,KAAK,CAACU,WAAW,CACrC,UAACqC,EAAU,EAAK;IACd,IAAMiB,OAAO,GAAGF,UAAU,CAACf,EAAE,CAAC;IAE9B,IAAIiB,OAAO,YAAYC,WAAW,EAAE;MAAA;MAClC,qBAAIhC,WAAW,CAACc,EAAE,CAAC,aAAf,cAAiBT,UAAU,EAAE;QAC/B0B,OAAO,CAACE,KAAK,EAAE;MACjB,CAAC,MAAM;QAAA;QACL;QACA,yBAACF,OAAO,CAACG,iBAAiB,qBAA1B,sBAA4CD,KAAK,EAAE;MACrD;IACF;EACF,CAAC,EACD,CAACjC,WAAW,EAAE6B,UAAU,CAAC,CAC1B;EAED,IAAMM,iBAAiB,GAAGpE,KAAK,CAACU,WAAW,CACzC,UAAC2D,UAAkB,EAAEC,QAAgB,EAAEC,IAAY,EAAK;IACtD,KAAK,IAAIC,CAAC,GAAGH,UAAU,EAAEG,CAAC,GAAGF,QAAQ,EAAE,EAAEE,CAAC,EAAE;MAAA;MAC1C;MACA,IAAMC,aAAa,kBAAGX,UAAU,CAAC9B,cAAc,CAACwC,CAAC,CAAC,CAAC,8CAA7B,YAA+BE,WAAW,+CAA1C,sBAA4CC,IAAI,EAAE,+CAAlD,uBAAoDC,MAAM,CAAC,CAAC,CAAC,qBAA7D,uBAA+DC,WAAW,EAAE;MAClG,IAAIJ,aAAa,KAAKF,IAAI,CAACM,WAAW,EAAE,EAAE;QACxC,OAAOL,CAAC;MACV;IACF;IACA,OAAO,CAAC,CAAC;EACX,CAAC,EACD,CAACV,UAAU,EAAE9B,cAAc,CAAC,CAC7B;EAED,IAAM8C,4BAA4B,GAAG9E,KAAK,CAACU,WAAW,CACpD,UAACyB,CAAsB,EAAE4C,eAAuB,EAAK;IACnD;IACA,IAAIC,SAAS,GAAGhD,cAAc,CAACS,OAAO,CAACsC,eAAe,CAAC,GAAG,CAAC;IAC3D,IAAIC,SAAS,KAAKhD,cAAc,CAACiD,MAAM,EAAE;MACvCD,SAAS,GAAG,CAAC;IACf;;IAEA;IACA,IAAIE,YAAY,GAAGd,iBAAiB,CAACY,SAAS,EAAEhD,cAAc,CAACiD,MAAM,EAAE9C,CAAC,CAACgD,GAAG,CAAC;IAC7E;IACA,IAAID,YAAY,KAAK,CAAC,CAAC,EAAE;MACvBA,YAAY,GAAGd,iBAAiB,CAAC,CAAC,EAAEY,SAAS,GAAG,CAAC,EAAE7C,CAAC,CAACgD,GAAG,CAAC;IAC3D;IAEA,IAAID,YAAY,KAAK,CAAC,CAAC,EAAE;MACvB,OAAOH,eAAe;IACxB;IAEA,OAAO/C,cAAc,CAACkD,YAAY,CAAC;EACrC,CAAC,EACD,CAACd,iBAAiB,EAAEpC,cAAc,CAAC,CACpC;EAED,OAAO;IACLlC,QAAQ,EAARA,QAAQ;IACRmC,WAAW,EAAXA,WAAW;IACXR,aAAa,EAAbA,aAAa;IACbO,cAAc,EAAdA,cAAc;IACd4B,eAAe,EAAfA,eAAe;IACfE,UAAU,EAAVA,UAAU;IACV5B,gBAAgB,EAAhBA,gBAAgB;IAChB6B,aAAa,EAAbA,aAAa;IACbf,cAAc,EAAdA,cAAc;IACdM,gBAAgB,EAAhBA,gBAAgB;IAChBwB,4BAA4B,EAA5BA;EACF,CAAC;AACH;AAEA,SAAS3D,kCAAkC,CAACC,KAAgD,EAAE;EAC5F,IAAI,CAACA,KAAK,EAAE;IACV,OAAO,EAAE;EACX;EAEA,IAAIgE,MAAM,GAAG,EAAE;EACfhE,KAAK,CAACiE,OAAO,CAAC,UAAAhD,IAAI,EAAI;IACpB,IAAIA,IAAI,CAACiD,QAAQ,EAAE;MACjBF,MAAM,CAACG,IAAI,CAAClD,IAAI,CAACU,EAAE,CAAC;IACtB;IAEA,IAAIV,IAAI,CAACjB,KAAK,EAAE;MACdgE,MAAM,GAAGA,MAAM,CAAC/B,MAAM,CACpBlC,kCAAkC,CAACkB,IAAI,CAACjB,KAAK,CAA6C,CAC3F;IACH;EACF,CAAC,CAAC;EACF,OAAOgE,MAAM;AACf;AAEA,SAAS5B,YAAY,CAACvB,WAAyC,EAAEuD,MAAc,EAAE;EAC/E,IAAMjC,KAAK,GAAG,EAAE;EAChB,IAAMkC,YAAY,GAAG,SAAfA,YAAY,CAAG1C,EAAE,EAAI;IAAA;IACzB,qBAAId,WAAW,CAACc,EAAE,CAAC,aAAf,cAAiBF,WAAW,EAAE;MAAA;MAChC,iBAAAZ,WAAW,CAACc,EAAE,CAAC,qBAAf,cAAiBF,WAAW,CAACwC,OAAO,CAAC,UAAAK,KAAK,EAAI;QAC5CD,YAAY,CAACC,KAAK,CAAC;MACrB,CAAC,CAAC;IACJ,CAAC,MAAM;MACLnC,KAAK,CAACgC,IAAI,CAACxC,EAAE,CAAC;IAChB;EACF,CAAC;EACD0C,YAAY,CAACD,MAAM,CAAC;EACpB,OAAOjC,KAAK;AACd"}