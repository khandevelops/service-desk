{"version":3,"file":"FiberNavigator.js","names":["ForwardRef","getReactFiberFromNode","isDOMNode","e","tagName","nodeType","Node","ELEMENT_NODE","FiberNavigator","__fiber","findDebugHookState","node","memoizedState","current","fluentUIDebug","next","isEqual","fiberNav","instance","find","condition","move","fiber","fromFiber","findOwner","owner","findParent","parent","key","isClassComponent","isFunctionComponent","type","displayName","name","isForwardRef","return","isHostComponent","stateNode","constructor","_debugOwner","child","memoizedProps","elementType","prototype","isReactComponent","$$typeof","isDOMComponent","render","setState","fiberNavigator","Object","defineProperty","value","enumerable","writable","configurable","fromDOMNode","domNode"],"sources":["components/Debug/FiberNavigator.ts"],"sourcesContent":["import { ForwardRef } from 'react-is';\nimport { getReactFiberFromNode, Fiber } from '../../utils/getReactFiberFromNode';\n\nconst isDOMNode = e => e && typeof e.tagName === 'string' && e.nodeType === Node.ELEMENT_NODE;\n\nexport class FiberNavigator {\n  __fiber: Fiber;\n\n  // TODO: Fibers can become stale.\n  //      The only current fiber is the one found on the DOM node.\n  //      There is no way to start at a React Component fiber, go the DOM node,\n  //      get the current fiber, and find your way back to the React Component fiber.\n  //      Probably need to remove fromFiber and re-implement using only DOM node weak map.\n  static fromFiber = fiber => {\n    if (!fiber) return null;\n\n    const fiberNavigator = new FiberNavigator();\n\n    Object.defineProperty(fiberNavigator, '__fiber', {\n      value: fiber,\n      enumerable: false,\n      writable: false,\n      configurable: false,\n    });\n\n    return fiberNavigator;\n  };\n\n  static fromDOMNode = domNode => {\n    const fiber = getReactFiberFromNode(domNode);\n\n    if (!fiber) return null;\n\n    const fiberNavigator = new FiberNavigator();\n\n    Object.defineProperty(fiberNavigator, '__fiber', {\n      value: fiber,\n      enumerable: false,\n      writable: false,\n      configurable: false,\n    });\n\n    return fiberNavigator;\n  };\n\n  get key() {\n    return this.__fiber.key;\n  }\n\n  get name() {\n    if (this.isClassComponent || this.isFunctionComponent) {\n      return this.__fiber.type.displayName || this.__fiber.type.name;\n    }\n    if (this.isForwardRef) {\n      return (\n        this.__fiber.type.displayName ||\n        this.__fiber.type.name ||\n        this.__fiber.type.return?.displayName ||\n        this.__fiber.type.return?.name\n      );\n    }\n    if (this.isHostComponent) {\n      return this.__fiber.stateNode.constructor.name;\n    }\n    return null;\n  }\n\n  get parent(): FiberNavigator {\n    return FiberNavigator.fromFiber(this.__fiber.return);\n  }\n\n  get owner() {\n    return FiberNavigator.fromFiber(this.__fiber._debugOwner);\n  }\n\n  get domNode() {\n    let fiber = this.__fiber;\n\n    do {\n      if (isDOMNode(fiber.stateNode)) {\n        return fiber.stateNode;\n      }\n      fiber = fiber.child;\n    } while (fiber);\n\n    return null;\n  }\n\n  get instance() {\n    if (this.isClassComponent) {\n      return this.__fiber.stateNode;\n    }\n\n    if (this.isFunctionComponent || this.isForwardRef) {\n      // assumes functional component w/useRef\n      return this.findDebugHookState(this.__fiber.memoizedState);\n    }\n\n    return null;\n  }\n\n  get props() {\n    return this.__fiber.memoizedProps;\n  }\n\n  get state() {\n    return this.__fiber.memoizedState;\n  }\n\n  /**\n   * Hooks state is represented by a recursive structure where:\n   * - `memoizedState` is a current value if applicable\n   * - `next` is next hook in order\n   * @param node - fiber\n   */\n  findDebugHookState(node) {\n    if (node && node.memoizedState && node.memoizedState.current && node.memoizedState.current.fluentUIDebug) {\n      return node.memoizedState.current;\n    }\n\n    if (node === null || node.next === null) {\n      return null;\n    }\n\n    return this.findDebugHookState(node.next);\n  }\n\n  get reactComponent() {\n    return this.isHostComponent ? this.owner.elementType : this.elementType;\n  }\n\n  get elementType() {\n    return this.__fiber.elementType;\n  }\n\n  get fluentUIDebug() {\n    return this.instance && this.instance.fluentUIDebug ? this.instance.fluentUIDebug : null;\n  }\n\n  get jsxString() {\n    return `<${this.name} />`;\n  }\n\n  //\n  // Methods\n  //\n\n  isEqual(fiberNav: FiberNavigator) {\n    // TODO: do equality check on __fiber instead, however, see fromFiber TODO :/\n    return !!fiberNav && fiberNav.instance === this.instance;\n  }\n\n  find(condition, move) {\n    let fiber: FiberNavigator = FiberNavigator.fromFiber(this.__fiber);\n\n    while (fiber) {\n      if (condition(fiber)) {\n        return fiber;\n      }\n      fiber = move(fiber);\n    }\n\n    return null;\n  }\n\n  findOwner(condition) {\n    return this.find(condition, fiber => fiber.owner);\n  }\n\n  findParent(condition) {\n    return this.find(condition, fiber => fiber.parent);\n  }\n\n  //\n  // Component Types\n  //\n\n  get isClassComponent() {\n    // React.Component subclasses have this flag\n    // https://reactjs.org/docs/implementation-notes.html\n    return typeof this.__fiber.type === 'function' && !!this.__fiber.type.prototype?.isReactComponent;\n  }\n\n  get isFunctionComponent() {\n    // React.Component subclasses have this flag\n    // https://reactjs.org/docs/implementation-notes.html\n    return typeof this.__fiber.type === 'function' && !this.__fiber.type.prototype?.isReactComponent;\n  }\n\n  get isForwardRef() {\n    return this.__fiber.type?.$$typeof === ForwardRef;\n  }\n\n  get isHostComponent() {\n    // Host components are platform components (i.e. 'div' on web)\n    // https://github.com/acdlite/react-fiber-architecture#type-and-key\n    return typeof this.__fiber.type === 'string';\n  }\n\n  //\n  // What this fiber component renders\n  //\n\n  get isDOMComponent() {\n    return !!this.__fiber.child && FiberNavigator.fromFiber(this.__fiber.child).isHostComponent;\n  }\n\n  // https://github.com/facebook/react/blob/16.8.6/packages/react-dom/src/test-utils/ReactTestUtils.js#L193\n  get isCompositeComponent() {\n    return this.isDOMComponent ? false : !!this.instance && !!this.instance.render && !!this.instance.setState;\n  }\n}\n"],"mappings":"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"}