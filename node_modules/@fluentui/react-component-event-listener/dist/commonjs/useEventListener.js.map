{"version":3,"file":"useEventListener.js","names":["React","_interopRequireWildcard","require","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","getWindowEvent","target","_ownerDocument$defaul","_ownerDocument","_ownerDocument$defaul2","window","event","ownerDocument","defaultView","undefined","isActionSupported","element","method","useEventListener","options","capture","listener","type","targetRef","latestListener","useRef","current","eventHandler","useCallback","timeoutId","process","env","NODE_ENV","useEffect","Error","currentEvent","conditionalHandler","addEventListener","setTimeout","clearTimeout","removeEventListener","exports"],"sources":["useEventListener.ts"],"sourcesContent":["import * as React from 'react';\n\nimport { EventHandler, EventListenerOptions, EventTypes, Target } from './types';\n\nconst getWindowEvent = (target: Target): Event | undefined => {\n  if (target) {\n    if (typeof (target as Window).window === 'object' && (target as Window).window === target) {\n      return target.event;\n    }\n\n    return (target as Node).ownerDocument?.defaultView?.event ?? undefined;\n  }\n\n  return undefined;\n};\n\nconst isActionSupported = (\n  element: Target | null | undefined,\n  method: 'addEventListener' | 'removeEventListener',\n): element is Target => (element ? !!element[method] : false);\n\nexport const useEventListener = <T extends EventTypes>(options: EventListenerOptions<T>): void => {\n  const { capture, listener, type, target, targetRef } = options;\n\n  const latestListener = React.useRef<EventHandler<T>>(listener);\n  latestListener.current = listener;\n\n  const eventHandler = React.useCallback((event: DocumentEventMap[T]) => {\n    return latestListener.current(event);\n  }, []);\n\n  const timeoutId = React.useRef<number | undefined>(undefined);\n\n  if (process.env.NODE_ENV !== 'production') {\n    // This is fine to violate there conditional rule as environment variables will never change during component\n    // lifecycle\n    // eslint-disable-next-line react-hooks/rules-of-hooks\n    React.useEffect(() => {\n      if (typeof target !== 'undefined' && typeof targetRef !== 'undefined') {\n        throw new Error('`target` and `targetRef` props are mutually exclusive, please use one of them.');\n      }\n\n      if (typeof target === 'undefined' && typeof targetRef === 'undefined') {\n        throw new Error(\"`target` and `targetRef` props are `undefined`, it' required to use one of them.\");\n      }\n    }, [target, targetRef]);\n  }\n\n  React.useEffect(() => {\n    const element: Target | null | undefined = typeof targetRef === 'undefined' ? target : targetRef.current;\n\n    // Store the current event to avoid triggering handlers immediately\n    // Note this depends on a deprecated but extremely well supported quirk of the web platform\n    // https://github.com/facebook/react/issues/20074\n    let currentEvent = getWindowEvent(window);\n\n    const conditionalHandler = (event: DocumentEventMap[T]) => {\n      // Skip if this event is the same as the one running when we added the handlers\n      if (event === currentEvent) {\n        currentEvent = undefined;\n        return;\n      }\n\n      eventHandler(event);\n    };\n\n    if (isActionSupported(element, 'addEventListener')) {\n      element.addEventListener(type, conditionalHandler, capture);\n    } else if (process.env.NODE_ENV !== 'production') {\n      throw new Error(\n        '@fluentui/react-component-event-listener: Passed `element` is not valid or does not support `addEventListener()` method.',\n      );\n    }\n\n    // @ts-ignore We have a collision between types from DOM and @types/node\n    timeoutId.current = setTimeout(() => {\n      currentEvent = undefined;\n    }, 1);\n\n    return () => {\n      clearTimeout(timeoutId.current);\n      currentEvent = undefined;\n\n      if (isActionSupported(element, 'removeEventListener')) {\n        element.removeEventListener(type, conditionalHandler, capture);\n      } else if (process.env.NODE_ENV !== 'production') {\n        throw new Error(\n          '@fluentui/react-component-event-listener: Passed `element` is not valid or does not support `removeEventListener()` method.',\n        );\n      }\n    };\n  }, [capture, eventHandler, target, targetRef, type]);\n};\n"],"mappings":"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"}