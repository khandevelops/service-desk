{"version":3,"file":"popupBehavior.js","names":["_keyboardKey","require","popupBehavior","props","onAsArray","_isArray2","default","on","tabbableTriggerProps","tabbableTrigger","tabIndex","getAriaAttributeFromProps","undefined","_props$trigger","_props$trigger2","trigger","hasOwnProperty","process","env","NODE_ENV","attributes","Object","assign","popup","role","trapFocus","inline","keyActions","closeAndFocusTrigger","keyCombinations","keyCode","keyboardKey","Escape","preventScroll","isOpenedByRightClick","_includes2","ArrowDown","ArrowUp","PageDown","PageUp","Home","End","close","toggle","Enter","SpacebarKey","open","click","exports","isFocusable","propsData","as","href","type","_unused","attributeName","defaultValue","_props$trigger$props"],"sources":["behaviors/Popup/popupBehavior.ts"],"sourcesContent":["import { keyboardKey, SpacebarKey } from '../../keyboard-key';\nimport * as _ from 'lodash';\n\nimport { Accessibility } from '../../types';\n\nexport const popupBehavior: Accessibility<PopupBehaviorProps> = props => {\n  const onAsArray = _.isArray(props.on) ? props.on : [props.on];\n  const tabbableTriggerProps = props.tabbableTrigger\n    ? { tabIndex: getAriaAttributeFromProps('tabIndex', props, 0) }\n    : undefined;\n\n  if (tabbableTriggerProps) {\n    tabbableTriggerProps['aria-haspopup'] = props.trigger?.props.hasOwnProperty('aria-haspopup')\n      ? props.trigger?.props['aria-haspopup']\n      : 'dialog';\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Override the default trigger's accessibility schema class.\n      tabbableTriggerProps['data-aa-class'] = 'PopupButton';\n    }\n  }\n\n  return {\n    attributes: {\n      trigger: {\n        ...tabbableTriggerProps,\n      },\n      popup: {\n        role: props.trapFocus ? 'dialog' : props.inline ? undefined : 'complementary',\n        'aria-modal': props.trapFocus ? true : undefined,\n        'data-popup-trapfocus': props.trapFocus ? true : undefined,\n      },\n    },\n    keyActions: {\n      popup: {\n        closeAndFocusTrigger: {\n          keyCombinations: [{ keyCode: keyboardKey.Escape }],\n        },\n        preventScroll: {\n          keyCombinations: props.isOpenedByRightClick &&\n            _.includes(onAsArray, 'context') && [\n              { keyCode: keyboardKey.ArrowDown },\n              { keyCode: keyboardKey.ArrowUp },\n              { keyCode: keyboardKey.PageDown },\n              { keyCode: keyboardKey.PageUp },\n              { keyCode: keyboardKey.Home },\n              { keyCode: keyboardKey.End },\n            ],\n        },\n      },\n      trigger: {\n        close: {\n          keyCombinations: [{ keyCode: keyboardKey.Escape }],\n        },\n        toggle: {\n          keyCombinations: _.includes(onAsArray, 'click') && [{ keyCode: keyboardKey.Enter }, { keyCode: SpacebarKey }],\n        },\n        open: {\n          keyCombinations: _.includes(onAsArray, 'hover') &&\n            !_.includes(onAsArray, 'context') && [{ keyCode: keyboardKey.Enter }, { keyCode: SpacebarKey }],\n        },\n        click: {\n          keyCombinations: _.includes(onAsArray, 'hover') &&\n            !_.includes(onAsArray, 'context') && [{ keyCode: keyboardKey.Enter }, { keyCode: SpacebarKey }],\n        },\n      },\n    },\n  };\n};\n\nconst isFocusable = propsData => {\n  try {\n    const { as, href, type } = propsData;\n    return type === 'button' || type === 'input' || (type === 'a' && href !== undefined) || as === 'button';\n  } catch {\n    return false;\n  }\n};\n\nconst getAriaAttributeFromProps = (attributeName: string, props: any, defaultValue: number | string) => {\n  if (!props.trigger) return undefined;\n  if (props.trigger.props[attributeName]) {\n    return props.trigger.props[attributeName];\n  }\n  const { as, href } = props.trigger.props;\n  const { type } = props.trigger;\n  if (isFocusable({ as, href, type })) {\n    return undefined;\n  }\n  return defaultValue;\n};\n\ntype PopupEvents = 'click' | 'hover' | 'focus' | 'context';\ntype RestrictedClickEvents = 'click' | 'focus';\ntype RestrictedHoverEvents = 'hover' | 'focus' | 'context';\ntype PopupEventsArray = RestrictedClickEvents[] | RestrictedHoverEvents[];\n\nexport type PopupBehaviorProps = {\n  /** Indicates if focus should be trapped inside popup's container. */\n  trapFocus?: boolean | object;\n  /** Events triggering the popup. */\n  on?: PopupEvents | PopupEventsArray;\n  /** Element which triggers popup */\n  trigger?: {\n    props?: {\n      /** Element type. */\n      as?: string;\n      href?: string;\n      tabIndex?: string;\n    };\n    /** Element type. */\n    type?: string;\n  };\n  /** Whether the trigger should be tabbable */\n  tabbableTrigger?: boolean;\n  /** Whether the popup was opened by right click */\n  isOpenedByRightClick?: boolean;\n  /** Whether the Popup should be rendered inline with the trigger or in the body. */\n  inline?: boolean;\n};\n"],"mappings":"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"}