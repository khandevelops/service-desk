{"version":3,"file":"popupBehavior.js","names":["keyboardKey","SpacebarKey","popupBehavior","props","onAsArray","_isArray","on","tabbableTriggerProps","tabbableTrigger","tabIndex","getAriaAttributeFromProps","undefined","_props$trigger","_props$trigger2","trigger","hasOwnProperty","process","env","NODE_ENV","attributes","Object","assign","popup","role","trapFocus","inline","keyActions","closeAndFocusTrigger","keyCombinations","keyCode","Escape","preventScroll","isOpenedByRightClick","_includes","ArrowDown","ArrowUp","PageDown","PageUp","Home","End","close","toggle","Enter","open","click","isFocusable","propsData","as","href","type","_unused","attributeName","defaultValue","_props$trigger$props"],"sources":["behaviors/Popup/popupBehavior.ts"],"sourcesContent":["import { keyboardKey, SpacebarKey } from '../../keyboard-key';\nimport * as _ from 'lodash';\n\nimport { Accessibility } from '../../types';\n\nexport const popupBehavior: Accessibility<PopupBehaviorProps> = props => {\n  const onAsArray = _.isArray(props.on) ? props.on : [props.on];\n  const tabbableTriggerProps = props.tabbableTrigger\n    ? { tabIndex: getAriaAttributeFromProps('tabIndex', props, 0) }\n    : undefined;\n\n  if (tabbableTriggerProps) {\n    tabbableTriggerProps['aria-haspopup'] = props.trigger?.props.hasOwnProperty('aria-haspopup')\n      ? props.trigger?.props['aria-haspopup']\n      : 'dialog';\n\n    if (process.env.NODE_ENV !== 'production') {\n      // Override the default trigger's accessibility schema class.\n      tabbableTriggerProps['data-aa-class'] = 'PopupButton';\n    }\n  }\n\n  return {\n    attributes: {\n      trigger: {\n        ...tabbableTriggerProps,\n      },\n      popup: {\n        role: props.trapFocus ? 'dialog' : props.inline ? undefined : 'complementary',\n        'aria-modal': props.trapFocus ? true : undefined,\n        'data-popup-trapfocus': props.trapFocus ? true : undefined,\n      },\n    },\n    keyActions: {\n      popup: {\n        closeAndFocusTrigger: {\n          keyCombinations: [{ keyCode: keyboardKey.Escape }],\n        },\n        preventScroll: {\n          keyCombinations: props.isOpenedByRightClick &&\n            _.includes(onAsArray, 'context') && [\n              { keyCode: keyboardKey.ArrowDown },\n              { keyCode: keyboardKey.ArrowUp },\n              { keyCode: keyboardKey.PageDown },\n              { keyCode: keyboardKey.PageUp },\n              { keyCode: keyboardKey.Home },\n              { keyCode: keyboardKey.End },\n            ],\n        },\n      },\n      trigger: {\n        close: {\n          keyCombinations: [{ keyCode: keyboardKey.Escape }],\n        },\n        toggle: {\n          keyCombinations: _.includes(onAsArray, 'click') && [{ keyCode: keyboardKey.Enter }, { keyCode: SpacebarKey }],\n        },\n        open: {\n          keyCombinations: _.includes(onAsArray, 'hover') &&\n            !_.includes(onAsArray, 'context') && [{ keyCode: keyboardKey.Enter }, { keyCode: SpacebarKey }],\n        },\n        click: {\n          keyCombinations: _.includes(onAsArray, 'hover') &&\n            !_.includes(onAsArray, 'context') && [{ keyCode: keyboardKey.Enter }, { keyCode: SpacebarKey }],\n        },\n      },\n    },\n  };\n};\n\nconst isFocusable = propsData => {\n  try {\n    const { as, href, type } = propsData;\n    return type === 'button' || type === 'input' || (type === 'a' && href !== undefined) || as === 'button';\n  } catch {\n    return false;\n  }\n};\n\nconst getAriaAttributeFromProps = (attributeName: string, props: any, defaultValue: number | string) => {\n  if (!props.trigger) return undefined;\n  if (props.trigger.props[attributeName]) {\n    return props.trigger.props[attributeName];\n  }\n  const { as, href } = props.trigger.props;\n  const { type } = props.trigger;\n  if (isFocusable({ as, href, type })) {\n    return undefined;\n  }\n  return defaultValue;\n};\n\ntype PopupEvents = 'click' | 'hover' | 'focus' | 'context';\ntype RestrictedClickEvents = 'click' | 'focus';\ntype RestrictedHoverEvents = 'hover' | 'focus' | 'context';\ntype PopupEventsArray = RestrictedClickEvents[] | RestrictedHoverEvents[];\n\nexport type PopupBehaviorProps = {\n  /** Indicates if focus should be trapped inside popup's container. */\n  trapFocus?: boolean | object;\n  /** Events triggering the popup. */\n  on?: PopupEvents | PopupEventsArray;\n  /** Element which triggers popup */\n  trigger?: {\n    props?: {\n      /** Element type. */\n      as?: string;\n      href?: string;\n      tabIndex?: string;\n    };\n    /** Element type. */\n    type?: string;\n  };\n  /** Whether the trigger should be tabbable */\n  tabbableTrigger?: boolean;\n  /** Whether the popup was opened by right click */\n  isOpenedByRightClick?: boolean;\n  /** Whether the Popup should be rendered inline with the trigger or in the body. */\n  inline?: boolean;\n};\n"],"mappings":"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"}