{"version":3,"file":"useAccessibility.js","names":["React","_interopRequireWildcard","require","_getAccessibility","_FocusZone","_useIsomorphicLayoutEffect","_getRequireWildcardCache","nodeInterop","WeakMap","cacheBabelInterop","cacheNodeInterop","obj","__esModule","default","cache","has","get","newObj","hasPropertyDescriptor","Object","defineProperty","getOwnPropertyDescriptor","key","prototype","hasOwnProperty","call","desc","set","useAccessibility","behavior","options","_options","actionHandlers","_options$debugName","debugName","_options$mapPropsToBe","mapPropsToBehavior","_options$rtl","rtl","definition","getAccessibility","latestDefinition","useRef","slotHandlers","slotProps","useIsomorphicLayoutEffect","current","getA11yProps","slotName","userProps","hasKeyDownHandlers","Boolean","keyHandlers","onKeyDown","childBehavior","childBehaviors","undefined","e","_latestDefinition$cur","_latestDefinition$cur2","accessibilityHandler","userHandler","_len","arguments","length","args","Array","_key","apply","concat","finalProps","assign","accessibility","attributes","unstable_wrapWithFocusZone","element","focusZone","child","process","env","NODE_ENV","Children","only","createElement","FocusZone","props","innerRef","ref","as","type","isRtl","unstable_behaviorDefinition","exports"],"sources":["hooks/useAccessibility.ts"],"sourcesContent":["import { Accessibility, AccessibilityAttributesBySlot } from '@fluentui/accessibility';\nimport * as React from 'react';\n\nimport { getAccessibility } from '../accessibility/getAccessibility';\nimport { AccessibilityActionHandlers, KeyboardEventHandler, ReactAccessibilityBehavior } from '../accessibility/types';\nimport { FocusZone } from '../FocusZone/FocusZone';\nimport { useIsomorphicLayoutEffect } from './useIsomorphicLayoutEffect';\n\ntype UseAccessibilityOptions<Props> = {\n  actionHandlers?: AccessibilityActionHandlers;\n  debugName?: string;\n  mapPropsToBehavior?: () => Props;\n  rtl?: boolean;\n};\n\ntype UseAccessibilityResult = (<SlotProps extends Record<string, any> & UserProps>(\n  slotName: string,\n  slotProps: SlotProps,\n) => MergedProps<SlotProps>) & {\n  unstable_wrapWithFocusZone: (children: React.ReactElement) => React.ReactElement;\n  unstable_behaviorDefinition: () => ReactAccessibilityBehavior;\n};\n\ntype UserProps = {\n  onKeyDown?: KeyboardEventHandler;\n};\n\ntype MergedProps<SlotProps extends Record<string, any> = any> = SlotProps &\n  Partial<AccessibilityAttributesBySlot> &\n  UserProps;\n\nexport const useAccessibility = <Props>(\n  behavior: Accessibility<Props>,\n  options: UseAccessibilityOptions<Props> = {},\n) => {\n  const { actionHandlers, debugName = 'Undefined', mapPropsToBehavior = () => ({}), rtl = false } = options;\n\n  const definition = getAccessibility(debugName, behavior, mapPropsToBehavior(), rtl, actionHandlers);\n\n  const latestDefinition = React.useRef<ReactAccessibilityBehavior>();\n  const slotHandlers = React.useRef<Record<string, KeyboardEventHandler>>({});\n  const slotProps = React.useRef<Record<string, UserProps>>({});\n\n  useIsomorphicLayoutEffect(() => {\n    latestDefinition.current = definition;\n  });\n\n  const getA11yProps: UseAccessibilityResult = (slotName, userProps) => {\n    const hasKeyDownHandlers = Boolean(definition.keyHandlers[slotName] || userProps.onKeyDown);\n    const childBehavior = definition.childBehaviors ? definition.childBehaviors[slotName] : undefined;\n    slotProps.current[slotName] = userProps;\n\n    // We want to avoid adding event handlers until it's really needed\n    if (hasKeyDownHandlers) {\n      if (!slotHandlers.current[slotName]) {\n        slotHandlers.current[slotName] = (e, ...args) => {\n          const accessibilityHandler = latestDefinition.current?.keyHandlers[slotName]?.onKeyDown;\n          const userHandler = slotProps.current[slotName].onKeyDown;\n\n          if (accessibilityHandler) accessibilityHandler(e);\n          if (userHandler) userHandler(e, ...args);\n        };\n      }\n    } else {\n      delete slotHandlers.current[slotName];\n    }\n\n    const finalProps: MergedProps = {\n      ...(childBehavior && { accessibility: childBehavior }),\n      ...definition.attributes[slotName],\n      ...userProps,\n      onKeyDown: slotHandlers.current[slotName],\n    };\n\n    return finalProps;\n  };\n\n  // Provides an experimental handling for FocusZone definition in behaviors\n  getA11yProps.unstable_wrapWithFocusZone = (element: React.ReactElement & React.RefAttributes<any>) => {\n    if (definition.focusZone) {\n      let child: React.ReactElement & React.RefAttributes<any> = element;\n\n      if (process.env.NODE_ENV !== 'production') {\n        child = React.Children.only(element);\n      }\n\n      return React.createElement(FocusZone, {\n        ...definition.focusZone.props,\n        ...child.props,\n        innerRef: child.ref,\n        as: child.type,\n        isRtl: rtl,\n      });\n    }\n\n    return element;\n  };\n\n  getA11yProps.unstable_behaviorDefinition = () => definition;\n\n  return getA11yProps;\n};\n"],"mappings":"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"}