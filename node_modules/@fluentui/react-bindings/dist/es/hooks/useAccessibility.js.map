{"version":3,"file":"useAccessibility.js","names":["React","getAccessibility","FocusZone","useIsomorphicLayoutEffect","useAccessibility","behavior","options","_options","actionHandlers","_options$debugName","debugName","_options$mapPropsToBe","mapPropsToBehavior","_options$rtl","rtl","definition","latestDefinition","useRef","slotHandlers","slotProps","current","getA11yProps","slotName","userProps","hasKeyDownHandlers","Boolean","keyHandlers","onKeyDown","childBehavior","childBehaviors","undefined","e","_latestDefinition$cur","_latestDefinition$cur2","accessibilityHandler","userHandler","_len","arguments","length","args","Array","_key","apply","concat","finalProps","Object","assign","accessibility","attributes","unstable_wrapWithFocusZone","element","focusZone","child","process","env","NODE_ENV","Children","only","createElement","props","innerRef","ref","as","type","isRtl","unstable_behaviorDefinition"],"sources":["hooks/useAccessibility.ts"],"sourcesContent":["import { Accessibility, AccessibilityAttributesBySlot } from '@fluentui/accessibility';\nimport * as React from 'react';\n\nimport { getAccessibility } from '../accessibility/getAccessibility';\nimport { AccessibilityActionHandlers, KeyboardEventHandler, ReactAccessibilityBehavior } from '../accessibility/types';\nimport { FocusZone } from '../FocusZone/FocusZone';\nimport { useIsomorphicLayoutEffect } from './useIsomorphicLayoutEffect';\n\ntype UseAccessibilityOptions<Props> = {\n  actionHandlers?: AccessibilityActionHandlers;\n  debugName?: string;\n  mapPropsToBehavior?: () => Props;\n  rtl?: boolean;\n};\n\ntype UseAccessibilityResult = (<SlotProps extends Record<string, any> & UserProps>(\n  slotName: string,\n  slotProps: SlotProps,\n) => MergedProps<SlotProps>) & {\n  unstable_wrapWithFocusZone: (children: React.ReactElement) => React.ReactElement;\n  unstable_behaviorDefinition: () => ReactAccessibilityBehavior;\n};\n\ntype UserProps = {\n  onKeyDown?: KeyboardEventHandler;\n};\n\ntype MergedProps<SlotProps extends Record<string, any> = any> = SlotProps &\n  Partial<AccessibilityAttributesBySlot> &\n  UserProps;\n\nexport const useAccessibility = <Props>(\n  behavior: Accessibility<Props>,\n  options: UseAccessibilityOptions<Props> = {},\n) => {\n  const { actionHandlers, debugName = 'Undefined', mapPropsToBehavior = () => ({}), rtl = false } = options;\n\n  const definition = getAccessibility(debugName, behavior, mapPropsToBehavior(), rtl, actionHandlers);\n\n  const latestDefinition = React.useRef<ReactAccessibilityBehavior>();\n  const slotHandlers = React.useRef<Record<string, KeyboardEventHandler>>({});\n  const slotProps = React.useRef<Record<string, UserProps>>({});\n\n  useIsomorphicLayoutEffect(() => {\n    latestDefinition.current = definition;\n  });\n\n  const getA11yProps: UseAccessibilityResult = (slotName, userProps) => {\n    const hasKeyDownHandlers = Boolean(definition.keyHandlers[slotName] || userProps.onKeyDown);\n    const childBehavior = definition.childBehaviors ? definition.childBehaviors[slotName] : undefined;\n    slotProps.current[slotName] = userProps;\n\n    // We want to avoid adding event handlers until it's really needed\n    if (hasKeyDownHandlers) {\n      if (!slotHandlers.current[slotName]) {\n        slotHandlers.current[slotName] = (e, ...args) => {\n          const accessibilityHandler = latestDefinition.current?.keyHandlers[slotName]?.onKeyDown;\n          const userHandler = slotProps.current[slotName].onKeyDown;\n\n          if (accessibilityHandler) accessibilityHandler(e);\n          if (userHandler) userHandler(e, ...args);\n        };\n      }\n    } else {\n      delete slotHandlers.current[slotName];\n    }\n\n    const finalProps: MergedProps = {\n      ...(childBehavior && { accessibility: childBehavior }),\n      ...definition.attributes[slotName],\n      ...userProps,\n      onKeyDown: slotHandlers.current[slotName],\n    };\n\n    return finalProps;\n  };\n\n  // Provides an experimental handling for FocusZone definition in behaviors\n  getA11yProps.unstable_wrapWithFocusZone = (element: React.ReactElement & React.RefAttributes<any>) => {\n    if (definition.focusZone) {\n      let child: React.ReactElement & React.RefAttributes<any> = element;\n\n      if (process.env.NODE_ENV !== 'production') {\n        child = React.Children.only(element);\n      }\n\n      return React.createElement(FocusZone, {\n        ...definition.focusZone.props,\n        ...child.props,\n        innerRef: child.ref,\n        as: child.type,\n        isRtl: rtl,\n      });\n    }\n\n    return element;\n  };\n\n  getA11yProps.unstable_behaviorDefinition = () => definition;\n\n  return getA11yProps;\n};\n"],"mappings":"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"}