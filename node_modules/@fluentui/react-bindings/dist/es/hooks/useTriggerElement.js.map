{"version":3,"file":"useTriggerElement.js","names":["Ref","React","ReactIs","childrenExist","isDisabledInteractive","node","nodeName","disabled","isInteractiveFilter","NodeFilter","FILTER_ACCEPT","FILTER_SKIP","useTriggerElement","props","trigger","children","element","Children","only","process","env","NODE_ENV","isFragment","Error","ref","useRef","useEffect","current","_ref$current$ownerDoc","console","warn","join","treeWalker","ownerDocument","createTreeWalker","SHOW_ELEMENT","acceptNode","nextNode","_node$ownerDocument","_node$ownerDocument$d","currentNode","nodeStyles","defaultView","getComputedStyle","pointerEvents","createElement","_extends","innerRef"],"sources":["hooks/useTriggerElement.tsx"],"sourcesContent":["import { Ref } from '@fluentui/react-component-ref';\nimport * as React from 'react';\nimport * as ReactIs from 'react-is';\n\nimport { childrenExist } from '../utils/childrenExist';\n\ntype UseTriggerElementOptions = {\n  children?: React.ReactNode;\n  trigger?: React.ReactElement;\n};\n\n// https://github.com/facebook/react/blob/c4e0768d7487a9359b74986e3b07841d2520f593/packages/react-dom/src/events/getListener.js#L15-L22\nfunction isDisabledInteractive(node: Node): boolean {\n  return (\n    (node.nodeName === 'BUTTON' ||\n      node.nodeName === 'INPUT' ||\n      node.nodeName === 'SELECT' ||\n      node.nodeName === 'TEXTAREA') &&\n    (node as HTMLButtonElement).disabled\n  );\n}\n\nfunction isInteractiveFilter(node: Node) {\n  return isDisabledInteractive(node) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;\n}\n\n/**\n * Performs consistent checks for components that are using `trigger` pattern (`Tooltip`, `Popup`). Ensures that\n * `children` or `trigger` props will always pass a valid React element to what additional props and handlers can\n * be applied.\n */\nexport function useTriggerElement(props: UseTriggerElementOptions): React.ReactElement | null {\n  const trigger = childrenExist(props.children) ? props.children : props.trigger;\n  const element = trigger ? (React.Children.only(trigger) as React.ReactElement) : null;\n\n  // An exception should not be thrown in tests as components might be rendered without styles\n  if (process.env.NODE_ENV !== 'production' && process.env.NODE_ENV !== 'test') {\n    if (ReactIs.isFragment(element)) {\n      throw new Error(\n        'useTriggerElement(): A \"React.Fragment\" cannot be used as a \"trigger\" as it will be impossible to spread props on it',\n      );\n    }\n\n    // Hooks are used only for dev mode validations and will be removed in production builds\n    /* eslint-disable react-hooks/rules-of-hooks */\n\n    const ref = React.useRef<HTMLElement>() as React.RefObject<HTMLElement | HTMLButtonElement>;\n\n    React.useEffect(() => {\n      if (ref.current) {\n        if (isDisabledInteractive(ref.current)) {\n          // eslint-disable-next-line no-console\n          console.warn(\n            [\n              'useTriggerElement(): Disabled elements should used as a \"trigger\" accurately as it may lead to ',\n              'unexpected behavior as pointer events are ignored on disabled elements. Please wrap your \"trigger\" with',\n              'an additional element like a \"div\" if you need to show tooltips or popups on disabled elements, an',\n              'example is available in docs:',\n              'https://fluentsite.z22.web.core.windows.net/components/tooltip/definition#usage-disabled-trigger',\n            ].join(' '),\n          );\n        }\n\n        const treeWalker = ref.current.ownerDocument?.createTreeWalker(ref.current, NodeFilter.SHOW_ELEMENT, {\n          acceptNode: isInteractiveFilter,\n        });\n        while (treeWalker?.nextNode()) {\n          const node = treeWalker.currentNode;\n          const nodeStyles = node.ownerDocument?.defaultView?.getComputedStyle(node as Element);\n\n          if (nodeStyles?.pointerEvents !== 'none') {\n            throw new Error(\n              [\n                'useTriggerElement(): A disabled element should have explicit \"pointer-events: \"none\" in its styles',\n                'due a bug in Chrome that breaks \"onMouseLeave\" event in React:',\n                'https://github.com/facebook/react/issues/19692',\n              ].join(' '),\n            );\n          }\n        }\n      }\n    }, []);\n\n    return element ? (\n      /* Required as components may call handlers via `trigger.props`, Ref will pass unhandled props down */\n      <Ref {...(element as React.ReactElement).props} innerRef={ref}>\n        {element}\n      </Ref>\n    ) : null;\n  }\n\n  return element;\n}\n"],"mappings":"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"}