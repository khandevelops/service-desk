{"version":3,"file":"resolveVariables.js","names":["callable","mergeComponentVariables","withDebugId","variablesCache","WeakMap","resolveVariables","displayNames","theme","variables","enabledVariablesCaching","componentThemeVariables","effectiveDisplayNames","filter","displayName","componentVariables","has","set","variablesThemeCache","get","handlingDisplayName","length","siteVariables","reduce","acc","undefined"],"sources":["styles/resolveVariables.ts"],"sourcesContent":["import {\n  callable,\n  ComponentVariablesInput,\n  ComponentVariablesObject,\n  ComponentVariablesPrepared,\n  mergeComponentVariables,\n  ThemePrepared,\n  withDebugId,\n} from '@fluentui/styles';\n\nconst variablesCache = new WeakMap<ThemePrepared, Record<string, ComponentVariablesObject>>();\n\nexport const resolveVariables = (\n  displayNames: string[],\n  theme: ThemePrepared,\n  variables: ComponentVariablesInput | undefined,\n  enabledVariablesCaching: boolean | undefined,\n): ComponentVariablesObject => {\n  let componentThemeVariables: ComponentVariablesObject;\n\n  // Filter out components that doesn't have defined variables in theme\n  const effectiveDisplayNames = displayNames.filter(displayName => !!theme.componentVariables[displayName]);\n\n  //\n  // Simple caching model, works only if there is no `props.variables`\n  // Resolves variables for this component, cache the result in provider\n  //\n\n  if (enabledVariablesCaching) {\n    if (!variablesCache.has(theme)) {\n      variablesCache.set(theme, {});\n    }\n\n    const variablesThemeCache = variablesCache.get(theme) || {};\n\n    // const displayNames = { Foo: variables, Bar: undefined, Baz: undefined }\n    // This allows to avoid creating useless cache entries for `Bar` & `Baz` components\n    const handlingDisplayName = effectiveDisplayNames[effectiveDisplayNames.length - 1];\n\n    if (!variablesThemeCache[handlingDisplayName]) {\n      // A short circle to avoid additional merging for non-composed components\n      if (effectiveDisplayNames.length === 1) {\n        variablesThemeCache[handlingDisplayName] = callable(theme.componentVariables[handlingDisplayName])(\n          theme.siteVariables,\n        );\n      } else {\n        variablesThemeCache[handlingDisplayName] = effectiveDisplayNames.reduce<ComponentVariablesPrepared>(\n          (acc, displayName) => {\n            return mergeComponentVariables(acc, theme.componentVariables[displayName]);\n          },\n          () => ({}),\n        )(theme.siteVariables);\n      }\n\n      variablesCache.set(theme, variablesThemeCache);\n    }\n\n    componentThemeVariables = variablesThemeCache[handlingDisplayName];\n  } else if (effectiveDisplayNames.length === 1) {\n    componentThemeVariables = callable(theme.componentVariables[effectiveDisplayNames[0]])(theme.siteVariables) || {};\n  } else {\n    componentThemeVariables = effectiveDisplayNames.reduce<ComponentVariablesPrepared>(\n      (acc, displayName) => {\n        return mergeComponentVariables(acc, theme.componentVariables[displayName]);\n      },\n      () => ({}),\n    )(theme.siteVariables);\n  }\n\n  if (variables === undefined) {\n    return componentThemeVariables;\n  }\n\n  return mergeComponentVariables(\n    componentThemeVariables,\n    withDebugId(variables, 'props.variables'),\n  )(theme.siteVariables);\n};\n"],"mappings":"AAAA,SACEA,QAAQ,EAIRC,uBAAuB,EAEvBC,WAAW,QACN,kBAAkB;AAEzB,IAAMC,cAAc,GAAG,IAAIC,OAAO,CAA0D,CAAC;AAE7F,OAAO,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAgBA,CAC3BC,YAAsB,EACtBC,KAAoB,EACpBC,SAA8C,EAC9CC,uBAA4C,EACf;EAC7B,IAAIC,uBAAiD;;EAErD;EACA,IAAMC,qBAAqB,GAAGL,YAAY,CAACM,MAAM,CAAC,UAAAC,WAAW;IAAA,OAAI,CAAC,CAACN,KAAK,CAACO,kBAAkB,CAACD,WAAW,CAAC;EAAA,EAAC;;EAEzG;EACA;EACA;EACA;;EAEA,IAAIJ,uBAAuB,EAAE;IAC3B,IAAI,CAACN,cAAc,CAACY,GAAG,CAACR,KAAK,CAAC,EAAE;MAC9BJ,cAAc,CAACa,GAAG,CAACT,KAAK,EAAE,CAAC,CAAC,CAAC;IAC/B;IAEA,IAAMU,mBAAmB,GAAGd,cAAc,CAACe,GAAG,CAACX,KAAK,CAAC,IAAI,CAAC,CAAC;;IAE3D;IACA;IACA,IAAMY,mBAAmB,GAAGR,qBAAqB,CAACA,qBAAqB,CAACS,MAAM,GAAG,CAAC,CAAC;IAEnF,IAAI,CAACH,mBAAmB,CAACE,mBAAmB,CAAC,EAAE;MAC7C;MACA,IAAIR,qBAAqB,CAACS,MAAM,KAAK,CAAC,EAAE;QACtCH,mBAAmB,CAACE,mBAAmB,CAAC,GAAGnB,QAAQ,CAACO,KAAK,CAACO,kBAAkB,CAACK,mBAAmB,CAAC,CAAC,CAChGZ,KAAK,CAACc,aACR,CAAC;MACH,CAAC,MAAM;QACLJ,mBAAmB,CAACE,mBAAmB,CAAC,GAAGR,qBAAqB,CAACW,MAAM,CACrE,UAACC,GAAG,EAAEV,WAAW,EAAK;UACpB,OAAOZ,uBAAuB,CAACsB,GAAG,EAAEhB,KAAK,CAACO,kBAAkB,CAACD,WAAW,CAAC,CAAC;QAC5E,CAAC,EACD;UAAA,OAAO,CAAC,CAAC;QAAA,CACX,CAAC,CAACN,KAAK,CAACc,aAAa,CAAC;MACxB;MAEAlB,cAAc,CAACa,GAAG,CAACT,KAAK,EAAEU,mBAAmB,CAAC;IAChD;IAEAP,uBAAuB,GAAGO,mBAAmB,CAACE,mBAAmB,CAAC;EACpE,CAAC,MAAM,IAAIR,qBAAqB,CAACS,MAAM,KAAK,CAAC,EAAE;IAC7CV,uBAAuB,GAAGV,QAAQ,CAACO,KAAK,CAACO,kBAAkB,CAACH,qBAAqB,CAAC,CAAC,CAAC,CAAC,CAAC,CAACJ,KAAK,CAACc,aAAa,CAAC,IAAI,CAAC,CAAC;EACnH,CAAC,MAAM;IACLX,uBAAuB,GAAGC,qBAAqB,CAACW,MAAM,CACpD,UAACC,GAAG,EAAEV,WAAW,EAAK;MACpB,OAAOZ,uBAAuB,CAACsB,GAAG,EAAEhB,KAAK,CAACO,kBAAkB,CAACD,WAAW,CAAC,CAAC;IAC5E,CAAC,EACD;MAAA,OAAO,CAAC,CAAC;IAAA,CACX,CAAC,CAACN,KAAK,CAACc,aAAa,CAAC;EACxB;EAEA,IAAIb,SAAS,KAAKgB,SAAS,EAAE;IAC3B,OAAOd,uBAAuB;EAChC;EAEA,OAAOT,uBAAuB,CAC5BS,uBAAuB,EACvBR,WAAW,CAACM,SAAS,EAAE,iBAAiB,CAC1C,CAAC,CAACD,KAAK,CAACc,aAAa,CAAC;AACxB,CAAC"}