(window.webpackJsonp_8496636c_2300_4915_abef_20de64c98d8b_1_17_1=window.webpackJsonp_8496636c_2300_4915_abef_20de64c98d8b_1_17_1||[]).push([[8],{oWJm:function(e,t,n){"use strict";n.r(t),n.d(t,"_SECURE_BROKER_DOMAIN",function(){return d}),n.d(t,"_BrokerClient",function(){return l});var a=n("17wl"),i=n("UWqr"),r=n("2q6Q"),o="customerPromise";function s(){return i._SPKillSwitch.isActivated("f493582d-419b-4ae5-b7f6-661d8cdb87bd")}var c=n("K9kD"),d="https://securebroker.sharepointonline.com",l=function(){function e(){}return e.getAuthToken=function(t,n,a,o,s){void 0===a&&(a=!1);var c=new r._QosMonitor("BrokerClient.getAuthToken",!0),d=window.location.origin.split(".")[0];d=d.substring(d.lastIndexOf("-app"));var l=!!i.Guid.tryParse(d.substring(d.length-36));return e._ensureBrokerWindow(a).then(function(i){return e._getAuthToken(t,i,n,a,o,s)}).then(function(t){return t?(c.writeSuccess({isIsolated:l}),a&&(e._brokerClientPerfMarks.SSBBrokerLogonGetAuthTokenEnd=Date.now()),Promise.resolve(t)):Promise.reject("UndefinedAuthToken")}).catch(function(e){return c.writeUnexpectedFailure(e,new Error(e),{isIsolated:l}),Promise.reject("BrokerClient.getAuthToken Rejected: ".concat(e))})},e.getPerfMarks=function(){return e._ensureBrokerWindow().then(function(t){return e._getPerfMarks(t)}).then(function(t){var n=Object(a.__assign)(Object(a.__assign)(Object(a.__assign)({},t),e._brokerClientPerfMarks),e._firstBrokerLoginLoadPerfMarks);return Promise.resolve(n)}).catch(function(e){return Promise.reject("BrokerClient.getPerformanceMarks reject: ".concat(e))})},e.markCustomerPromiseEnd=function(t){s()||e._ensureBrokerWindow().then(function(n){var a={action:o,endCPData:t};n.postMessage(a,e._TARGET_ORIGIN_OPTION)}).catch(function(e){})},e.markCustomerPromiseFailure=function(t){s()||e._ensureBrokerWindow().then(function(n){var a={action:o,endCPData:{resultType:c.ResultTypeEnum.Failure,errorCode:t}};n.postMessage(a,e._TARGET_ORIGIN_OPTION)}).catch(function(e){})},e.logPerformance=function(t,n,i){e._ensureBrokerWindow().then(function(r){var o=Object(a.__assign)(Object(a.__assign)({},e._brokerClientPerfMarks),t);0===Object.keys(e._firstBrokerLoginLoadPerfMarks).length&&(e._firstBrokerLoginLoadPerfMarks=t);var s={action:"logPerfMarkers",marks:o,error:n,hadRetry:i};r.postMessage(s,e._TARGET_ORIGIN_OPTION),e._brokerClientPerfMarks={}}).catch(function(e){})},e.markContentPageLoaded=function(t,n){e._ensureBrokerWindow().then(function(a){var i={action:"contentPageLoaded",result:t,errorMessage:n};a.postMessage(i,e._TARGET_ORIGIN_OPTION)}).catch(function(e){})},e.initializeBrokerClient=function(){this._ensureBrokerWindow().catch(function(e){})},e._getAuthToken=function(t,n,a,o,s,c){var d=this;void 0===o&&(o=!1);var l,u={action:"requestToken",claims:a,resource:t,identifier:e._messageIdentifier,correlationId:s};o&&(e._brokerClientPerfMarks.SSBBrokerLogonRequestTokenStart=Date.now());var f=new Promise(function(t,n){var a=e._messageIdentifier++;e._getAuthTokenResolvers.set(a,{reject:n,resolve:t,timeout:l})});return n.postMessage(u,e._TARGET_ORIGIN_OPTION),Promise.race([f,new Promise(function(e,u){l=setTimeout(function(){if(!i._SPKillSwitch.isActivated("c86e5bc9-b3a1-414b-b884-f3148cacdeb8")&&c){var e=new r._QosMonitor("BrokerClient.getAuthTokenRetry",!0);return d._getAuthToken(t,n,a,o,s,!1).then(function(t){return e.writeSuccess(),t}).catch(function(t){throw e.writeUnexpectedFailure("FailedToGetRetryToken",t),t})}u("GetAuthTokenTimeout")},1e4)})])},e._getPerfMarks=function(t){e._getPerfMarksPromise=new Promise(function(t){e._getPerfMarksResolver=t});return t.postMessage({action:"getPerfMarkers"},e._TARGET_ORIGIN_OPTION),e._getPerfMarksAndTimeOutPromise=Promise.race([e._getPerfMarksPromise,new Promise(function(t,n){e._getPerfMarksTimeOutPromise=setTimeout(function(){n("GetPerfMarkersTimeout")},1e4)})]),e._getPerfMarksAndTimeOutPromise},e._ensureBrokerWindow=function(t){if(void 0===t&&(t=!1),t&&(e._brokerClientPerfMarks.SSBBrokerLogonFindBrokerWindowStart=Date.now()),!e._secureBrokerWindowAndTimeOutPromise){e._secureBrokerWindowMonitor=new r._QosMonitor("BrokerClient.EnsureBrokerWindow"),e._secureBrokerWindowPromise=new Promise(function(t){e._secureBrokerWindowResolver=t}),e._ensureMessageHandlers();for(var n=window,a={action:"getBrokerWindow",isBrokerLoginLoad:t};n!==n.parent;)n.parent.postMessage(a,d),n=n.parent;e._secureBrokerWindowAndTimeOutPromise=Promise.race([e._secureBrokerWindowPromise,new Promise(function(t,n){e._timeOutPromise=setTimeout(function(){var t;n("EnsureBrokerWindowTimeout"),null===(t=e._secureBrokerWindowMonitor)||void 0===t||t.writeUnexpectedFailure("EnsureBrokerWindowTimeout")},1e4)})])}return e._secureBrokerWindowAndTimeOutPromise},e._ensureMessageHandlers=function(){e._messageHandlersAdded||(window.addEventListener("message",e._handleMessage),e._messageHandlersAdded=!0)},e._handleMessage=function(t){var n;if(t.origin&&t.data&&t.origin===d)if("ackBrokerWindow"===t.data.action)clearTimeout(e._timeOutPromise),e._secureBrokerWindowResolver(t.source),null===(n=e._secureBrokerWindowMonitor)||void 0===n||n.writeSuccess({brokerCorrelationId:t.data.correlationId}),t.data.isBrokerLoginLoad&&(e._brokerClientPerfMarks.SSBBrokerLogonFindBrokerWindowSuccess=Date.now());else if("returnToken"===t.data.action){var a=t.data,i=e._getAuthTokenResolvers.get(a.requestIdentifier);clearTimeout(i.timeout),i.resolve(a.result)}else if("rejectToken"===t.data.action||"errorOriginDoesNotMatchRequestedToken"===t.data.action)a=t.data,i=e._getAuthTokenResolvers.get(a.requestIdentifier),clearTimeout(i.timeout),i.reject("".concat(t.data.action,": ").concat(t.data.error,"}"));else if("returnPerfMarkers"===t.data.action){var r=t.data.marks;clearTimeout(e._getPerfMarksTimeOutPromise),e._getPerfMarksResolver(r)}},e._TARGET_ORIGIN_OPTION={targetOrigin:d},e._messageIdentifier=0,e._getAuthTokenResolvers=new Map,e._brokerClientPerfMarks={},e._firstBrokerLoginLoadPerfMarks={},e}()}}]);